(function(window,Object,undefined){qc.landlord={},window.G=qc.landlord.G={},qc.initGame=function(e){e.log.trace("Start the game landlord."),G.game=e,G.gameRule=new qc.landlord.GameRule,G.online=new qc.landlord.Online,String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")}};var AICardType=qc.landlord.AICardType=function(e,t){this.val=e,this.cardList=t},AILogic=qc.landlord.AILogic=function(e){this.player=e,this.cards=e.cardList.slice(0),this.analyse()};AILogic.prototype.follow=function(e,t,n){var r=this;r.log();var i=function(){switch(e.cardKind){case G.gameRule.ONE:var i=r.matchCards(r._one,G.gameRule.ONE,e,t,n);if(!i){if(t||r.player.isLandlord)for(var s=0;s<r.cards.length;s++)if(r.cards[s].val<=15&&r.cards[s].val>e.val)return{cardList:r.cards.slice(s,s+1),cardKind:G.gameRule.ONE,size:1,val:r.cards[s].val};if(r.times<=1&&r._pairs.length>0&&r._pairs[0].val>10){var o=r.cards.slice(0,1);return o[0].val>e.val?{cardList:o,cardKind:G.gameRule.ONE,size:1,val:o[0].val}:null}}return i;case G.gameRule.PAIRS:var u=r._pairs.length>0?r.matchCards(r._pairs,G.gameRule.PAIRS,e,t,n):null;if(u==null&&(t||r.player.isLandlord))if(r._progressionPairs.length>0)for(var s=r._progressionPairs.length-1;s>=0;s--){if(e.val>=r._progressionPairs[s].val)continue;for(var a=r._progressionPairs[s].cardList.length-1;a>=0;a-=2)if(r._progressionPairs[s].cardList[a].val>e.val){var f=r._progressionPairs[s].cardList.splice(a-1,2);return{cardList:f,cardKind:G.gameRule.PAIRS,size:2,val:f[0].val}}}else if(r._three.length>0)for(var s=r._three.length-1;s>=0;s--)if(r._three[s].val>e.val)return{cardList:r._three[s].cardList.slice(0,2),cardKind:G.gameRule.PAIRS,size:2,val:r._three[s].val};return u;case G.gameRule.THREE:if(!t&&!r.player.isLandlord)return null;return r.matchCards(r._three,G.gameRule.THREE,e,t,n);case G.gameRule.THREE_WITH_ONE:if(!t&&!r.player.isLandlord)return null;var l=r.minCards(r._three,G.gameRule.THREE,e.val);if(l){var i=r.minOne(2,l.val);if(!i)return null;l.cardList.push(i),l.cardKind=G.gameRule.THREE_WITH_ONE,l.size=4}return l;case G.gameRule.THREE_WITH_PAIRS:if(!t&&!r.player.isLandlord)return null;var l=r.minCards(r._three,G.gameRule.THREE,e.val);if(l){var u=r.minCards(r._pairs,G.gameRule.PAIRS);for(;;){if(u.cardList[0].val!==l.val)break;u=r.minCards(r._pairs,G.gameRule.PAIRS,u.cardList[0].val)}if(!u)return null;l.cardList=l.cardList.concat(u.cardList)}return l;case G.gameRule.PROGRESSION:if(!t&&!r.player.isLandlord)return null;if(r._progression.length>0)for(var s=r._progression.length-1;s>=0;s--)if(e.val<r._progression[s].val&&e.size<=r._progression[s].cardList.length){if(e.size===r._progression[s].cardList.length)return r.setCardKind(r._progression[s],G.gameRule.PROGRESSION);if(r.player.isLandlord||t){var c=r._progression[s].val-e.val,h=r._progression[s].cardList.length-e.size;for(var a=0;a<h;a++){if(c>1){r._progression[s].cardList.shift(),c--;continue}r._progression[s].cardList.pop()}return r.setCardKind(r._progression[s],G.gameRule.PROGRESSION)}return null}return null;case G.gameRule.PROGRESSION_PAIRS:if(!t&&!r.player.isLandlord)return null;if(r._progressionPairs.length>0)for(var s=r._progressionPairs.length-1;s>=0;s--)if(e.val<r._progressionPairs[s].val&&e.size<=r._progressionPairs[s].cardList.length){if(e.size===r._progressionPairs[s].cardList.length)return r.setCardKind(r._progressionPairs[s],G.gameRule.PROGRESSION_PAIRS);if(r.player.isLandlord||t){var c=r._progressionPairs[s].val-e.val,h=(r._progressionPairs[s].cardList.length-e.size)/2;for(var a=0;a<h;a++){if(c>1){r._progressionPairs[s].cardList.shift(),r._progressionPairs[s].cardList.shift(),c--;continue}r._progressionPairs[s].cardList.pop(),r._progressionPairs[s].cardList.pop()}return r.setCardKind(r._progressionPairs[s],G.gameRule.PROGRESSION_PAIRS)}return null}return null;case G.gameRule.PLANE:if(!t&&!r.player.isLandlord)return null;return r.minPlane(e.size,e);case G.gameRule.PLANE_WITH_ONE:if(!t&&!r.player.isLandlord)return null;var p=e.size/4,d=r.minPlane(p*3,e);if(d){var v=2;for(var s=0;s<p;s++){var i=r.minOne(v,d.val);if(!i)return null;d.cardList.push(i),v=i.val}d.cardKind=G.gameRule.PLANE_WITH_ONE,d.size=d.cardList.length}return d;case G.gameRule.PLANE_WITH_PAIRS:if(!t&&!r.player.isLandlord)return null;var p=e.size/5,d=r.minPlane(p*3,e);if(d){var m=2;for(var s=0;s<p;s++){var u=r.minCards(r._pairs,G.gameRule.PAIRS,m);if(!u)return null;d.cardList=d.cardList.concat(u.cardList),m=u.val}d.cardKind=G.gameRule.PLANE_WITH_PAIRS,d.size=d.cardList.length}return d;case G.gameRule.BOMB:if(!t&&!r.player.isLandlord)return null;var g=r.minCards(r._bomb,G.gameRule.BOMB,e.val);if(g)return g;if(r._kingBomb.length>0)if(t&&n<6||r.player.isLandlord&&r.player.cardList.length<6)return r.setCardKind(r._kingBomb[0],G.gameRule.KING_BOMB);return null;case G.gameRule.FOUR_WITH_TWO:return r.minCards(r._bomb,G.gameRule.BOMB,e.val);case G.gameRule.FOUR_WITH_TWO_PAIRS:return r.minCards(r._bomb,G.gameRule.BOMB,e.val);case G.gameRule.KING_BOMB:return null;default:return null}}();if(i)return i;if(e.cardKind==G.gameRule.BOMB||e.cardKind==G.gameRule.KING_BOMB||!(r._bomb.length>0||r._kingBomb.length>0))return null;if(t&&n<5||r.player.isLandlord&&(r.player.cardList.length<5||r.player.nextPlayer.cardList.length<5||r.player.nextPlayer.nextPlayer.cardList.length<6)||r.times()<=2)return r._bomb.length>0?r.minCards(r._bomb,G.gameRule.BOMB):r.setCardKind(r._kingBomb[0],G.gameRule.KING_BOMB)},AILogic.prototype.play=function(e){var t=this;t.log();var n=function(e){var n=t.cards[e];for(var r=0;r<t._one.length;r++)if(t._one[r].val===n.val)return t.minCards(t._one,G.gameRule.ONE);for(r=0;r<t._pairs.length;r++)if(t._pairs[r].val===n.val)return t.minCards(t._pairs,G.gameRule.PAIRS);for(r=0;r<t._three.length;r++)if(t._three[r].val===n.val)return t.minCards(t._three,G.gameRule.THREE);for(r=0;r<t._bomb.length;r++)if(t._bomb[r].val===n.val)return t.minCards(t._bomb,G.gameRule.BOMB);for(r=0;r<t._plane.length;r++)for(var i=0;i<t._plane[r].cardList.length;i++)if(t._plane[r].cardList[i].val===n.val&&t._plane[r].cardList[i].type===n.type)return t.minCards(t._plane,G.gameRule.PLANE);for(r=0;r<t._progression.length;r++)for(var i=0;i<t._progression[r].cardList.length;i++)if(t._progression[r].cardList[i].val===n.val&&t._progression[r].cardList[i].type===n.type)return t.minCards(t._progression,G.gameRule.PROGRESSION);for(r=0;r<t._progressionPairs.length;r++)for(var i=0;i<t._progressionPairs[r].cardList.length;i++)if(t._progressionPairs[r].cardList[i].val===n.val&&t._progressionPairs[r].cardList[i].type===n.type)return t.minCards(t._progressionPairs,G.gameRule.PROGRESSION_PAIRS);if(t._kingBomb.length>0)return t.minCards(t._kingBomb,G.gameRule.KING_BOMB)};for(var r=t.cards.length-1;r>=0;r--){var i=n(r);if(i.cardKind!==G.gameRule.ONE){if(i.cardKind===G.gameRule.THREE){var f=t.minCards(t._three,G.gameRule.THREE),o=f.cardList.length/3;if(t._one.length>=0){var a=t.minOne(u,f.val);return f.cardList.push(a),t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(t._pairs.length>0){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);return f.cardList=f.cardList.concat(l.cardList),t.setCardKind(f,G.gameRule.THREE_WITH_PAIRS)}return t.setCardKind(f,G.gameRule.THREE)}if(i.cardKind===G.gameRule.PLANE){var s=t.minCards(t._plane,G.gameRule.PLANE),o=s.cardList.length/3;if(t._one.length>o&&t._pairs.length>o){if(t._one.length>=t._pairs.length){var u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}var c=2;for(var r=0;r<o;r++){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);s.cardList=s.cardList.concat(l.cardList),c=l.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_PAIRS)}if(t._pairs.length>o){var c=2;for(var r=0;r<o;r++){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);s.cardList=s.cardList.concat(l.cardList),c=l.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_PAIRS)}if(t._one.length>o){var u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}return t.setCardKind(s,G.gameRule.PLANE)}if(i.cardKind===G.gameRule.BOMB&&t.times()===1)return i;if(i.cardKind===G.gameRule.BOMB&&t.times()!=1)continue;return i}if(t._plane.length>0){var s=t.minCards(t._plane,G.gameRule.PLANE),o=s.cardList.length/3,u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}if(t._three.length>0){var f=t.minCards(t._three,G.gameRule.THREE),o=f.cardList.length/3,a=t.minOne(u,f.val);f.cardList.push(a);if(f.val<14)return t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(!t.player.isLandlord)return e<=2?t.playOneAtTheEnd(e):t.minCards(t._one,G.gameRule.ONE);if(t.player.isLandlord)return t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2?t.playOneAtTheEnd(e):t.minCards(t._one,G.gameRule.ONE)}},AILogic.prototype.playOneAtTheEnd=function(e){var t=this;if(t._progression.length>0)return t.minCards(t._progression,G.gameRule.PROGRESSION);if(t._plane.length>0){var n=t.minCards(t._plane,G.gameRule.PLANE),r=n.cardList.length/3;if(t._one.length>r&&t._pairs.length>r){if(t._one.length>=t._pairs.length){var i=2;for(var s=0;s<r;s++){var o=t.minOne(i,n.val);n.cardList.push(o),i=o.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_ONE)}var u=2;for(var s=0;s<r;s++){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);n.cardList=n.cardList.concat(a.cardList),u=a.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_PAIRS)}if(t._pairs.length>r){var u=2;for(var s=0;s<r;s++){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);n.cardList=n.cardList.concat(a.cardList),u=a.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_PAIRS)}if(t._one.length>r){var i=2;for(var s=0;s<r;s++){var o=t.minOne(i,n.val);n.cardList.push(o),i=o.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_ONE)}return t.setCardKind(n,G.gameRule.PLANE)}if(t._progressionPairs.length>0)return t.minCards(t._progressionPairs,G.gameRule.PROGRESSION_PAIRS);if(t._three.length>0){var f=t.minCards(t._three,G.gameRule.THREE),r=f.cardList.length/3;if(t._one.length>=0){var o=t.minOne(i,f.val);return f.cardList.push(o),t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(t._pairs.length>0){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);return f.cardList=f.cardList.concat(a.cardList),t.setCardKind(f,G.gameRule.THREE_WITH_PAIRS)}return t.setCardKind(f,G.gameRule.THREE)}if(t._pairs.length>0)return t.player.isLandlord&&(t.player.nextPlayer.cardList.length===2||t.player.nextPlayer.nextPlayer.cardList.length===2)||!t.player.isLandlord&&e===2?t.maxCards(t._pairs,G.gameRule.PAIRS):t.minCards(t._pairs,G.gameRule.PAIRS);if(t._one.length>0)return t.player.isLandlord&&(t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2)||!t.player.isLandlord&&e<=2?t.maxCards(t._one,G.gameRule.ONE):t.minCards(t._one,G.gameRule.ONE);var o=null;return t.player.isLandlord&&(t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2)||!t.player.isLandlord&&e<=2?o=t.cards.slice(t.cards.length-1,t.cards.length):o=t.cards.slice(0,1),{size:1,cardKind:G.gameRule.ONE,cardList:o,val:o[0].val}},AILogic.prototype.prompt=function(e){var t=this,n=G.gameRule.valCount(t.cards);if(e){var r=[],i=function(e,n,r){var i=[];for(var s=r.length-1;s>=0;s--)(r[s].count<e||r[s].val<=n)&&r.splice(s,1);r.sort(t.promptSort);for(s=0;s<r.length;s++)for(f=0;f<t.cards.length;f++)if(t.cards[f].val===r[s].val){i.push(t.cards.slice(f,f+e));break}return i},s=function(n){var r=[];if(e.val<14&&t.cards.length>=e.size)for(var i=e.val+1;i<15;i++){var s=[];for(var o=0;o<t.cards.length;o++){if(t.cards[o].val<i&&s.length===0)break;if(t.cards[o].val>i||s.length>0&&t.cards[o].val===s[s.length-1].val)continue;if(t.cards[o].val===i&&t.cards[o+1]&&t.cards[o+1].val===i&&t.cards[o+2]&&t.cards[o+2].val===i&&s.length===0){s=s.concat(t.cards.slice(o,o+3)),o+=2;continue}if(!(s.length>0&&s[s.length-1].val-1===t.cards[o].val&&t.cards[o+1]&&s[s.length-1].val-1===t.cards[o+1].val&&t.cards[o+2]&&s[s.length-1].val-1===t.cards[o+2].val))break;s=s.concat(t.cards.slice(o,o+3)),o+=2;if(s.length===n*3){r.push(s);break}}}return r};switch(e.cardKind){case G.gameRule.ONE:r=i(1,e.val,n);break;case G.gameRule.PAIRS:r=i(2,e.val,n);break;case G.gameRule.THREE:r=i(3,e.val,n);break;case G.gameRule.THREE_WITH_ONE:var o=i(3,e.val,n.slice(0)),u=i(1,2,n.slice(0));for(var a=0;a<o.length;a++)for(var f=0;f<u.length;f++)u[f][0].val!=o[a][0].val&&r.push(o[a].concat(u[f]));break;case G.gameRule.THREE_WITH_PAIRS:var o=i(3,e.val,n.slice(0)),l=i(2,2,n.slice(0));for(var a=0;a<o.length;a++)for(var f=0;f<l.length;f++)l[f][0].val!=o[a][0].val&&r.push(o[a].concat(l[f]));break;case G.gameRule.PROGRESSION:if(e.val<14&&t.cards.length>=e.size)for(var a=e.val+1;a<15;a++){var c=[];for(var f=0;f<t.cards.length;f++){if(t.cards[f].val<a&&c.length===0)break;if(t.cards[f].val>a||c.length>0&&t.cards[f].val===c[c.length-1].val)continue;if(t.cards[f].val===a&&c.length===0){c.push(t.cards.slice(f,f+1)[0]);continue}if(c[c.length-1].val-1!==t.cards[f].val)break;c.push(t.cards.slice(f,f+1)[0]);if(c.length===e.size){r.push(c);break}}}break;case G.gameRule.PROGRESSION_PAIRS:if(e.val<14&&t.cards.length>=e.size)for(var a=e.val+1;a<15;a++){var c=[];for(var f=0;f<t.cards.length;f++){if(t.cards[f].val<a&&c.length===0)break;if(t.cards[f].val>a||c.length>0&&t.cards[f].val===c[c.length-1].val)continue;if(t.cards[f].val===a&&t.cards[f+1]&&t.cards[f+1].val===a&&c.length===0){c=c.concat(t.cards.slice(f,f+2)),f++;continue}if(!(c.length>0&&c[c.length-1].val-1===t.cards[f].val&&t.cards[f+1]&&c[c.length-1].val-1===t.cards[f+1].val))break;c=c.concat(t.cards.slice(f,f+2)),f++;if(c.length===e.size){r.push(c);break}}}break;case G.gameRule.PLANE:r=s(e.size/3);break;case G.gameRule.PLANE_WITH_ONE:r=s(e.size/4);break;case G.gameRule.PLANE_WITH_PAIRS:r=s(e.size/5);break;case G.gameRule.FOUR_WITH_TWO:r=i(4,e.val,n);break;case G.gameRule.FOUR_WITH_TWO_PAIRS:r=i(4,e.val,n);break;case G.gameRule.BOMB:r=i(4,e.val,n);break;default:}if(e.cardKind!=G.gameRule.KING_BOMB&&e.cardKind!=G.gameRule.BOMB&&t._bomb.length>0)for(var a=t._bomb.length-1;a>=0;a--)r.push(t._bomb[a].cardList);return e.cardKind!=G.gameRule.KING_BOMB&&t._kingBomb.length>0&&r.push(t._kingBomb[0].cardList),r}var r=[];for(var a=n.length-1;a>=0;a--)a!=0?r.push(t.cards.splice(t.cards.length-n[a].count,t.cards.length-1)):r.push(t.cards);return r},AILogic.prototype.getMinVal=function(e,t){var n=this,r=G.gameRule.valCount(n.cards);for(var i=r.length-1;i>=0;i--)if(r[i].count===e&&r[i].val>t)return n.cards.splice(i,1)},AILogic.prototype.analyse=function(){var e=this,t=e.cards.slice(0),n=null,r=null,i=null,s=null,o=null;e._one=[],e._pairs=[],e._kingBomb=[],e._bomb=[],e._three=[],e._plane=[],e._progression=[],e._progressionPairs=[],t.sort(G.gameRule.cardSort),G.gameRule.isKingBomb(t.slice(0,2))&&e._kingBomb.push(new qc.landlord.AICardType(17,t.splice(0,2))),n=G.gameRule.valCount(t);for(var u=0;u<n.length;u++)if(n[u].count===4){var a=[];e.moveItem(t,a,n[u].val),e._bomb.push(new qc.landlord.AICardType(a[0].val,a))}r=t.slice(0),i=r.slice(0),e.judgeThree(i),e.judgePlane();for(u=0;u<e._three.length;u++)i=i.concat(e._three[u].cardList);e._three=[],i.sort(G.gameRule.cardSort),s=i.slice(0),e.judgeProgression(s),e.judgeProgressionPairs(s),e.judgeThree(s),n=G.gameRule.valCount(s);for(u=0;u<n.length;u++)if(n[u].count===1)for(var f=0;f<s.length;f++)s[f].val===n[u].val&&e._one.push(new qc.landlord.AICardType(n[u].val,s.splice(f,1)));else if(n[u].count===2)for(var f=0;f<s.length;f++)s[f].val===n[u].val&&e._pairs.push(new qc.landlord.AICardType(n[u].val,s.splice(f,2)))},AILogic.prototype.judgeThree=function(e){var t=this,n=G.gameRule.valCount(e);for(i=0;i<n.length;i++)if(n[i].count===3){var r=[];t.moveItem(e,r,n[i].val),t._three.push(new qc.landlord.AICardType(r[0].val,r))}},AILogic.prototype.judgePlane=function(){var e=this;if(e._three.length>1){var t=[];for(i=0;i<e._three.length;i++){if(e._three[i].val>=15)continue;if(t.length==0){t.push({obj:e._three[i],fromIndex:i});continue}if(t[t.length-1].val-1==e._three[i].val)t.push({obj:e._three[i],fromIndex:i});else{if(t.length>1){var n=[];for(var r=0;r<t.length;r++)n=n.concat(t[r].obj.cardList);e._plane.push(new qc.landlord.AICardType(t[0].obj.val,n));for(var s=t.length-1;s>=0;s--)e._three.splice(t[s].fromIndex,1)}t=[],t.push({obj:e._three[i],fromIndex:i})}}if(t.length>1){var n=[];for(var r=0;r<t.length;r++)n=n.concat(t[r].obj.cardList);e._plane.push(new qc.landlord.AICardType(t[0].obj.val,n));for(var s=t.length-1;s>=0;s--)e._three.splice(t[s].fromIndex,1)}}},AILogic.prototype.judgeProgression=function(e){var t=this,n=function(n){var r=[];for(var i=0;i<n.length;i++)r.push(n[i].obj);t._progression.push(new qc.landlord.AICardType(n[0].obj.val,r));for(var s=n.length-1;s>=0;s--)e.splice(n[s].fromIndex,1)};if(e.length>=5){var r=[];for(var i=0;i<e.length;i++){if(e[i].val>=15)continue;if(r.length==0){r.push({obj:e[i],fromIndex:i});continue}if(r[r.length-1].obj.val-1===e[i].val){r.push({obj:e[i],fromIndex:i});if(r.length===5)break}else{if(r[r.length-1].obj.val===e[i].val)continue;if(r.length>=5)break;r=[],r.push({obj:e[i],fromIndex:i})}}r.length===5?(n(r),t.judgeProgression(e)):t.joinProgression(e)}},AILogic.prototype.joinProgression=function(e){var t=this;for(var n=0;n<t._progression.length;n++)for(var r=0;r<e.length;r++)t._progression[n].val!=14&&t._progression[n].val===e[r].val-1?t._progression[n].cardList.unshift(e.splice(r,1)[0]):e[r].val===t._progression[n].val-t._progression[n].cardList.length&&t._progression[n].cardList.push(e.splice(r,1)[0]);var i=t._progression.slice(0);for(n=0;n<i.length;n++)n<i.length-1&&i[n].val-i[n].cardList.length===i[n+1].val&&(t._progression[n].cardList=t._progression[n].cardList.concat(t._progression[n+1].cardList),t._progression.splice(++n,1))},AILogic.prototype.judgeProgressionPairs=function(e){var t=this,n=function(n){var r=[];for(var i=n.length-1;i>=0;i--)for(var s=0;s<e.length;s++)if(e[s].val===n[i]){r=r.concat(e.splice(s,2));break}r.sort(G.gameRule.cardSort),t._progressionPairs.push(new qc.landlord.AICardType(n[0],r))};if(e.length>=6){var r=[],i=G.gameRule.valCount(e);for(var s=0;s<i.length;s++){if(i[s].val>=15)continue;if(r.length==0&&i[s].count>=2){r.push(i[s].val);continue}if(r[r.length-1]-1===i[s].val&&i[s].count>=2)r.push(i[s].val);else{if(r.length>=3)break;r=[],i[s].count>=2&&r.push(i[s].val)}}r.length>=3&&(n(r),t.judgeProgressionPairs(e))}},AILogic.prototype.moveItem=function(e,t,n){for(var r=e.length-1;r>=0;r--)e[r].val===n&&t.push(e.splice(r,1)[0])},AILogic.prototype.setCardKind=function(e,t){return e.cardKind=t,e.size=e.cardList.length,e},AILogic.prototype.minPlane=function(e,t){var n=this;if(n._plane.length>0)for(var r=n._plane.length-1;r>=0;r--)if(t.val<n._plane[r].val&&e<=n._plane[r].cardList.length){if(e===n._plane[r].cardList.length)return n.setCardKind(n._plane[r],G.gameRule.PLANE);var i=n._plane[r].val-t.val,s=(n._plane[r].cardList.length-e)/3;for(var o=0;o<s;o++){if(i>1){for(var u=0;u<3;u++)n._plane[r].cardList.shift();i--;continue}for(var u=0;u<3;u++)n._plane[r].cardList.pop()}return n.setCardKind(n._plane[r],G.gameRule.PLANE)}return null},AILogic.prototype.minCards=function(e,t,n){var r=this;n=n?n:2;if(e.length>0)for(var i=e.length-1;i>=0;i--)if(n<e[i].val)return r.setCardKind(e[i],t);return null},AILogic.prototype.maxCards=function(e,t,n){var r=this,i=null;if(e.length>0){for(var s=0;s<e.length;s++)if(i&&e[s].val>i.val||!i)i=e[s];return n?i.val>n?r.setCardKind(i,t):null:r.setCardKind(i,t)}return null},AILogic.prototype.matchCards=function(e,t,n,r,i){var s=this;if(s.player.isLandlord)return s.player.nextPlayer.cardList.length<3||s.player.nextPlayer.nextPlayer.cardList.length<3?s.maxCards(e,t,n.val):s.minCards(e,t,n.val);if(r)return i<3?s.maxCards(e,t,n.val):s.minCards(e,t,n.val);var o=null;return s.player.nextPlayer.isLandlord&&s.player.nextPlayer.cardList.length<3?s.maxCards(e,t,n.val):(o=s.minCards(e,t,n.val),o?o.val<14||s.times()<=2?o:null:null)},AILogic.prototype.minOne=function(e,t){var n=this,r=n.minCards(n._one,G.gameRule.ONE,e),i=n.offPairs(t);return r?r.val>14?i?(n.deleteOne(i),i):null:r.cardList[0]:i?(n.deleteOne(i),i):null},AILogic.prototype.offPairs=function(e,t){var n=this,r=n.minCards(n._pairs,G.gameRule.PAIRS,e);if(r)for(;;){if(r.cardList[0].val!==t)break;r=n.minCards(n._pairs,G.gameRule.PAIRS,r.cardList[0].val)}return r?r.cardList[0]:null},AILogic.prototype.deleteOne=function(e){for(var t=0;t<this.cards.length;t++)this.cards[t].val===e.val&&this.cards[t].type===e.type&&this.cards.splice(t,1);this.analyse()},AILogic.prototype.judgeScore=function(){var e=this,t=0;t+=e._bomb.length*6,e._kingBomb.length>0?t+=8:e.cards[0].val===17?t+=4:e.cards[0].val===16&&(t+=3);for(var n=0;n<e.cards.length;n++)e.cards[n].val===15&&(t+=2);return console.info(e.player.name+"手牌评分："+t),t>=7?3:t>=5?2:t>=3?1:4},AILogic.prototype.promptSort=function(e,t){return e.count===t.count?e.val>t.val?1:-1:e.count<t.count?-1:1},AILogic.prototype.times=function(){var e=this,t=this._kingBomb.length+this._bomb.length+this._progression.length+this._progressionPairs.length+this._one.length+this._pairs.length,n=this._three.length;if(this._plane.length>0)for(var r=0;r<this._plane.length;r++)n+=this._plane[r].cardList.length/3;return n-(this._one.length+this._pairs.length)>0&&(t+=n-(this._one.length+this._pairs.length)),t},AILogic.prototype.log=function(){var e=this;console.info("以下显示【"+e.player.name+"】手牌概况，手数："+e.times()),console.info("王炸"),console.info(e._kingBomb),console.info("炸弹"),console.info(e._bomb),console.info("三根"),console.info(e._three),console.info("飞机"),console.info(e._plane),console.info("顺子"),console.info(e._progression),console.info("连对"),console.info(e._progressionPairs),console.info("单牌"),console.info(e._one),console.info("对子"),console.info(e._pairs)};var GameRule=qc.landlord.GameRule=function(){};GameRule.prototype.typeJudge=function(e){var t=this,n=e.length;switch(n){case 1:return{cardKind:t.ONE,val:e[0].val,size:n};case 2:return t.isPairs(e)?{cardKind:t.PAIRS,val:e[0].val,size:n}:t.isKingBomb(e)?{cardKind:t.KING_BOMB,val:e[0].val,size:n}:null;case 3:return t.isThree(e)?{cardKind:t.THREE,val:e[0].val,size:n}:null;case 4:if(t.isThreeWithOne(e))return{cardKind:t.THREE_WITH_ONE,val:t.getMaxVal(e,3),size:n};if(t.isBomb(e))return{cardKind:t.BOMB,val:e[0].val,size:n};return null;default:return t.isProgression(e)?{cardKind:t.PROGRESSION,val:e[0].val,size:n}:t.isProgressionPairs(e)?{cardKind:t.PROGRESSION_PAIRS,val:e[0].val,size:n}:t.isThreeWithPairs(e)?{cardKind:t.THREE_WITH_PAIRS,val:t.getMaxVal(e,3),size:n}:t.isPlane(e)?{cardKind:t.PLANE,val:t.getMaxVal(e,3),size:n}:t.isPlaneWithOne(e)?{cardKind:t.PLANE_WITH_ONE,val:t.getMaxVal(e,3),size:n}:t.isPlaneWithPairs(e)?{cardKind:t.PLANE_WITH_PAIRS,val:t.getMaxVal(e,3),size:n}:t.isFourWithTwo(e)?{cardKind:t.FOUR_WITH_TWO,val:t.getMaxVal(e,4),size:n}:t.isFourWithPairs(e)?{cardKind:t.FOUR_WITH_TWO_PAIRS,val:t.getMaxVal(e,4),size:n}:null}},GameRule.prototype.isPairs=function(e){return e.length==2&&e[0].val===e[1].val},GameRule.prototype.isThree=function(e){return e.length==3&&e[0].val===e[1].val&&e[1].val===e[2].val},GameRule.prototype.isThreeWithOne=function(e){if(e.length!=4)return!1;var t=this.valCount(e);return t.length===2&&(t[0].count===3||t[1].count===3)},GameRule.prototype.isThreeWithPairs=function(e){if(e.length!=5)return!1;var t=this.valCount(e);return t.length===2&&(t[0].count===3||t[1].count===3)},GameRule.prototype.isProgression=function(e){if(e.length<5||e[0].val===15)return!1;for(var t=0;t<e.length;t++)if(t!=e.length-1&&e[t].val-1!=e[t+1].val)return!1;return!0},GameRule.prototype.isProgressionPairs=function(e){if(e.length<6||e.length%2!=0||e[0].val===15)return!1;for(var t=0;t<e.length;t+=2)if(t!=e.length-2&&(e[t].val!=e[t+1].val||e[t].val-1!=e[t+2].val))return!1;return!0},GameRule.prototype.isPlane=function(e){if(e.length<6||e.length%3!=0||e[0].val===15)return!1;for(var t=0;t<e.length;t+=3)if(t!=e.length-3&&(e[t].val!=e[t+1].val||e[t].val!=e[t+2].val||e[t].val-1!=e[t+3].val))return!1;return!0},GameRule.prototype.isPlaneWithOne=function(e){if(e.length<8||e.length%4!=0)return!1;var t=this.valCount(e),n=[],r=e.length/4;for(var i=0;i<t.length;i++)t[i].count==3&&n.push(t[i]);if(n.length!=r||n[0].val===15)return!1;for(i=0;i<n.length;i++)if(i!=n.length-1&&n[i].val-1!=n[i+1].val)return!1;return!0},GameRule.prototype.isPlaneWithPairs=function(e){if(e.length<10||e.length%5!=0)return!1;var t=this.valCount(e),n=[],r=[],i=e.length/5;for(var s=0;s<t.length;s++)if(t[s].count==3)n.push(t[s]);else{if(t[s].count!=2)return!1;r.push(t[s])}if(n.length!=i||r.length!=i||n[0].val===15)return!1;for(s=0;s<n.length;s++)if(s!=n.length-1&&n[s].val-1!=n[s+1].val)return!1;return!0},GameRule.prototype.isFourWithTwo=function(e){var t=this.valCount(e);if(e.length!=6||t.length>3)return!1;for(var n=0;n<t.length;n++)if(t[n].count===4)return!0;return!1},GameRule.prototype.isFourWithPairs=function(e){if(e.length!=8)return!1;var t=this.valCount(e);if(t.length!=3)return!1;for(var n=0;n<t.length;n++)if(t[n].count!=4&&t[n].count!=2)return!1;return!0},GameRule.prototype.isBomb=function(e){return e.length===4&&e[0].val===e[1].val&&e[0].val===e[2].val&&e[0].val===e[3].val},GameRule.prototype.isKingBomb=function(e){return e.length===2&&e[0].type=="0"&&e[1].type=="0"},GameRule.prototype.random=function(e,t){e=e==null?0:e,t=t==null?1:t;var n=t-e+1;return Math.floor(Math.random()*n+e)},GameRule.prototype.valCount=function(e){var t=[],n=function(e,t){for(var n=0;n<e.length;n++)if(e[n].val==t){e[n].count++;return}e.push({val:t,count:1})};for(var r=0;r<e.length;r++)n(t,e[r].val);return t},GameRule.prototype.getMaxVal=function(e,t){var n=this.valCount(e),r=0;for(var i=0;i<n.length;i++)n[i].count===t&&n[i].val>r&&(r=n[i].val);return r},GameRule.prototype.cardSort=function(e,t){var n=parseInt(e.val),r=parseInt(t.val);return n===r?e.type>t.type?1:-1:n>r?-1:1},GameRule.prototype.ONE=1,GameRule.prototype.PAIRS=2,GameRule.prototype.THREE=3,GameRule.prototype.THREE_WITH_ONE=4,GameRule.prototype.THREE_WITH_PAIRS=5,GameRule.prototype.PROGRESSION=6,GameRule.prototype.PROGRESSION_PAIRS=7,GameRule.prototype.PLANE=8,GameRule.prototype.PLANE_WITH_ONE=9,GameRule.prototype.PLANE_WITH_PAIRS=10,GameRule.prototype.FOUR_WITH_TWO=11,GameRule.prototype.FOUR_WITH_TWO_PAIRS=12,GameRule.prototype.BOMB=13,GameRule.prototype.KING_BOMB=14,GameRule.prototype.MSG_NO_SELECT="请选择要出的牌",GameRule.prototype.MSG_ERROR_TYPE="您选择的牌不符合游戏规则",GameRule.prototype.MSG_NO_ROROB_RESTART="所有玩家均未叫分，重新发牌",GameRule.prototype.DESK_STATUS_READY=1,GameRule.prototype.DESK_STATUS_ROB=2,GameRule.prototype.DESK_STATUS_PLAY=3;var Player=qc.landlord.Player=function(e){var t=this;t.name=e?e:"Player",t.isLandlord=!1,t.isAI=!0,t.cardList=[],t.nextPlayer=null,t.uid=null,t.deskNo=null,t.seatNo=null,t.isReady=!1,t.isLeave=!1};Object.defineProperties(Player.prototype,{score:{get:function(){return this._score},set:function(e){this._score=e;var t=G.game.storage;t.set(this.name,e),t.save()}}});var Utils=qc.landlord.Utils=function(){};Utils.prototype.uuid=function(){var e=[],t="0123456789abcdef";for(var n=0;n<36;n++)e[n]=t.substr(Math.floor(Math.random()*16),1);e[14]="4",e[19]=t.substr(e[19]&3|8,1),e[8]=e[13]=e[18]=e[23]="_";var r=e.join("");return r};var Online=qc.landlord.Online=function(){var e=this;e.socket=io.connect("http://192.168.16.191:8081/",{"connect timeout":1e4}),e.init()};Online.prototype.connect=function(){},Online.prototype.ERR_EXIST_NAME=1,Online.prototype.register=function(e){var t=this;return new Promise(function(n,r){try{t.socket.emit("register",{name:e}),t.socket.on("registerResult",function(e){e.uid?n(e):r(t.ERR_EXIST_NAME)})}catch(i){console.info(i),r("error")}})},Online.prototype.joinGame=function(e){var t=this;return new Promise(function(n,r){try{t.socket.on("joinResult",function(e){console.log(e),n(e)}),t.socket.emit("joinGame",{uid:e})}catch(i){console.info(i)}})},Online.prototype.exitGame=function(){try{var e={deskNo:G.ownPlayer.deskNo,seatNo:G.ownPlayer.seatNo};this.socket.emit("exitGame",e),G.leftPlayer=null,G.rightPlayer=null}catch(t){console.info(t)}},Online.prototype.toggleReady=function(e){var t=this,n={deskNo:G.ownPlayer.deskNo,seatNo:G.ownPlayer.seatNo,isReady:e};t.socket.emit("toggleReady",n)},Online.prototype.robLandlord=function(e){var t=this,n={deskNo:G.ownPlayer.deskNo,seatNo:G.ownPlayer.seatNo,robScore:e};t.socket.emit("robLandlord",n)},Online.prototype.playCard=function(e){var t={deskNo:G.ownPlayer.deskNo,seatNo:G.ownPlayer.seatNo,cardInfo:e};this.socket.emit("playCard",t)},Online.prototype.init=function(){var e=this;e.socket.on("deskUpdate",function(e){window.onlinePlayUI.refreshInfo(e)}),e.socket.on("noticeReady",function(e){window.onlinePlayUI.playerReady(e)}),e.socket.on("start",function(e){console.info("restart"),console.info(e),window.onlinePlayUI.start(e)}),e.socket.on("robInfo",function(e){window.onlinePlayUI.robLandlord(e.nextSeatNo,e.currentScore,e.preSeatNo,e.preScore),console.info(e)}),e.socket.on("play",function(e){window.olLandlordUI.playTurn(e)}),e.socket.on("setLandlord",function(e){window.onlinePlayUI.setLandlord(e)}),e.socket.on("gameover",function(e){console.info("gameover"),console.info(e),window.olLandlordUI.judgeWinner(e)}),e.socket.on("forceExit",function(e){console.info("forceExit"),console.info(e),window.onlinePlayUI.forceExit(e)}),e.socket.on("playerBack",function(e){console.info("playerBack"),window.onlinePlayUI.playerBack(e)})},!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.io=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":2}],2:[function(e,t,n){function a(e,t){typeof e=="object"&&(t=e,e=undefined),t=t||{};var n=r(e),i=n.source,a=n.id,f;return t.forceNew||t["force new connection"]||!1===t.multiplex?(o("ignoring socket cache for %s",i),f=s(i,t)):(u[a]||(o("new io instance for %s",i),u[a]=s(i,t)),f=u[a]),f.socket(n.path)}var r=e("./url"),i=e("socket.io-parser"),s=e("./manager"),o=e("debug")("socket.io-client");t.exports=n=a;var u=n.managers={};n.protocol=i.protocol,n.connect=a,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":44}],3:[function(e,t,n){function d(e,t){if(!(this instanceof d))return new d(e,t);e&&"object"==typeof e&&(t=e,e=undefined),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new u.Encoder,this.decoder=new u.Decoder,this.autoConnect=t.autoConnect!==!1,this.autoConnect&&this.open()}var r=e("./url"),i=e("engine.io-client"),s=e("./socket"),o=e("component-emitter"),u=e("socket.io-parser"),a=e("./on"),f=e("component-bind"),l=e("object-component"),c=e("debug")("socket.io-client:manager"),h=e("indexof"),p=e("backo2");t.exports=d,d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},d.prototype.updateSocketIds=function(){for(var e in this.nsps)this.nsps[e].id=this.engine.id},o(d.prototype),d.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},d.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},d.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},d.prototype.open=d.prototype.connect=function(e){c("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=i(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var r=a(t,"open",function(){n.onopen(),e&&e()}),s=a(t,"error",function(t){c("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t);if(e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var o=this._timeout;c("connect attempt will timeout after %d",o);var u=setTimeout(function(){c("connect attempt timed out after %d",o),r.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",o)},o);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(r),this.subs.push(s),this},d.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",f(this,"ondata"))),this.subs.push(a(this.decoder,"decoded",f(this,"ondecoded"))),this.subs.push(a(e,"error",f(this,"onerror"))),this.subs.push(a(e,"close",f(this,"onclose")))},d.prototype.ondata=function(e){this.decoder.add(e)},d.prototype.ondecoded=function(e){this.emit("packet",e)},d.prototype.onerror=function(e){c("error",e),this.emitAll("error",e)},d.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new s(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){t.id=n.engine.id,~h(n.connected,t)||n.connected.push(t)})}return t},d.prototype.destroy=function(e){var t=h(this.connected,e);~t&&this.connected.splice(t,1);if(this.connected.length)return;this.close()},d.prototype.packet=function(e){c("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},d.prototype.cleanup=function(){var e;while(e=this.subs.shift())e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(e){c("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){if(e.skipReconnect)return;c("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts);if(e.skipReconnect)return;e.open(function(t){t?(c("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(c("reconnect success"),e.onreconnect())})},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:40,"object-component":41,"socket.io-parser":44}],4:[function(e,t,n){function r(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}t.exports=r},{}],5:[function(e,t,n){function h(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var r=e("socket.io-parser"),i=e("component-emitter"),s=e("to-array"),o=e("./on"),u=e("component-bind"),a=e("debug")("socket.io-client:socket"),f=e("has-binary");t.exports=n=h;var l={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},c=i.prototype.emit;i(h.prototype),h.prototype.subEvents=function(){if(this.subs)return;var e=this.io;this.subs=[o(e,"open",u(this,"onopen")),o(e,"packet",u(this,"onpacket")),o(e,"close",u(this,"onclose"))]},h.prototype.open=h.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},h.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},h.prototype.emit=function(e){if(l.hasOwnProperty(e))return c.apply(this,arguments),this;var t=s(arguments),n=r.EVENT;f(t)&&(n=r.BINARY_EVENT);var i={type:n,data:t};return"function"==typeof t[t.length-1]&&(a("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this},h.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},h.prototype.onopen=function(){a("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:r.CONNECT})},h.prototype.onclose=function(e){a("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},h.prototype.onpacket=function(e){if(e.nsp!=this.nsp)return;switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:this.onevent(e);break;case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:this.onack(e);break;case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},h.prototype.onevent=function(e){var t=e.data||[];a("emitting event %j",t),null!=e.id&&(a("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?c.apply(this,t):this.receiveBuffer.push(t)},h.prototype.ack=function(e){var t=this,n=!1;return function(){if(n)return;n=!0;var i=s(arguments);a("sending ack %j",i);var o=f(i)?r.BINARY_ACK:r.ACK;t.packet({type:o,id:e,data:i})}},h.prototype.onack=function(e){a("calling ack %s with %j",e.id,e.data);var t=this.acks[e.id];t.apply(this,e.data),delete this.acks[e.id]},h.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},h.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)c.apply(this,this.receiveBuffer[e]);this.receiveBuffer=[];for(e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},h.prototype.ondisconnect=function(){a("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},h.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},h.prototype.close=h.prototype.disconnect=function(){return this.connected&&(a("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":36,"socket.io-parser":44,"to-array":48}],6:[function(e,t,n){(function(n){function s(e,t){var s=e,t=t||n.location;return null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&("/"==e.charAt(1)?e=t.protocol+e:e=t.hostname+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),"undefined"!=typeof t?e=t.protocol+"//"+e:e="https://"+e),i("parse %s",e),s=r(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/",s.id=s.protocol+"://"+s.host+":"+s.port,s.href=s.protocol+"://"+s.host+(t&&t.port==s.port?"":":"+s.port),s}var r=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=s}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{debug:10,parseuri:42}],7:[function(e,t,n){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-n:e+n}return Math.min(e,this.max)|0},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},{}],8:[function(e,t,n){var r=[].slice;t.exports=function(e,t){"string"==typeof t&&(t=e[t]);if("function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},{}],9:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;var r;for(var i=0;i<n.length;i++){r=n[i];if(r===t||r.fn===t){n.splice(i,1);break}}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],10:[function(e,t,n){function r(e){return r.enabled(e)?function(t){t=i(t);var n=new Date,s=n-(r[e]||n);r[e]=n,t=e+" "+t+" +"+r.humanize(s),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function i(e){return e instanceof Error?e.stack||e.message:e}t.exports=r,r.names=[],r.skips=[],r.enable=function(e){try{localStorage.debug=e}catch(t){}var n=(e||"").split(/[\s,]+/),i=n.length;for(var s=0;s<i;s++)e=n[s].replace("*",".*?"),e[0]==="-"?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$"))},r.disable=function(){r.enable("")},r.humanize=function(e){var t=1e3,n=6e4,r=60*n;return e>=r?(e/r).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},r.enabled=function(e){for(var t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(var t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1};try{window.localStorage&&r.enable(localStorage.debug)}catch(s){}},{}],11:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":12}],12:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(e,t,n){(function(n){function c(){}function h(e,t){if(!(this instanceof h))return new h(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=a(e),t.host=e.host,t.secure=e.protocol=="https"||e.protocol=="wss",t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol;if(t.host){var r=t.host.split(":");t.hostname=r.shift(),r.length?t.port=r.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized||null,this.open()}function p(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var r=e("./transports"),i=e("component-emitter"),s=e("debug")("engine.io-client:socket"),o=e("indexof"),u=e("engine.io-parser"),a=e("parseuri"),f=e("parsejson"),l=e("parseqs");t.exports=h,h.priorWebsocketSuccess=!1,i(h.prototype),h.protocol=u.protocol,h.Socket=h,h.Transport=e("./transport"),h.transports=e("./transports"),h.parser=e("engine.io-parser"),h.prototype.createTransport=function(e){s('creating transport "%s"',e);var t=p(this.query);t.EIO=u.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return n},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1)e="websocket";else{if(0==this.transports.length){var t=this;setTimeout(function(){t.emit("error","No transports available")},0);return}e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(n){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){s("setting transport %s",e.name);var t=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},h.prototype.probe=function(e){function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}if(n)return;s('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(n)return;if("pong"==i.type&&"probe"==i.data){s('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t);if(!t)return;h.priorWebsocketSuccess="websocket"==t.name,s('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){if(n)return;if("closed"==r.readyState)return;s("changing transport and sending upgrade packet"),c(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush()})}else{s('probe transport "%s" failed',e);var o=new Error("probe error");o.transport=t.name,r.emit("upgradeError",o)}})}function o(){if(n)return;n=!0,c(),t.close(),t=null}function u(n){var i=new Error("probe error: "+n);i.transport=t.name,o(),s('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",i)}function a(){u("transport closed")}function f(){u("socket closed")}function l(e){t&&e.name!=t.name&&(s('"%s" works - aborting "%s"',e.name,t.name),o())}function c(){t.removeListener("open",i),t.removeListener("error",u),t.removeListener("close",a),r.removeListener("close",f),r.removeListener("upgrading",l)}s('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;h.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",u),t.once("close",a),this.once("close",f),this.once("upgrading",l),t.open()},h.prototype.onOpen=function(){s("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState){s('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat");switch(e.type){case"open":this.onHandshake(f(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}}else s('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen();if("closed"==this.readyState)return;this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){if("closed"==t.readyState)return;t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},h.prototype.ping=function(){this.sendPacket("ping")},h.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length==0?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},h.prototype.sendPacket=function(e,t,n){if("closing"==this.readyState||"closed"==this.readyState)return;var r={type:e,data:t};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()},h.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var e=this;function t(){e.onClose("forced close"),s("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}return this},h.prototype.onError=function(e){s("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){s('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},h.prototype.filterUpgrades=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)~o(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:40,parsejson:32,parseqs:33,parseuri:34}],14:[function(e,t,n){function s(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized}var r=e("engine.io-parser"),i=e("component-emitter");t.exports=s,i(s.prototype),s.timestamps=0,s.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},s.prototype.open=function(){if("closed"==this.readyState||""==this.readyState)this.readyState="opening",this.doOpen();return this},s.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState)this.doClose(),this.onClose();return this},s.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},s.prototype.onPacket=function(e){this.emit("packet",e)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(e,t,n){(function(t){function u(e){var n,o=!1,u=!1,a=!1!==e.jsonp;if(t.location){var f="https:"==location.protocol,l=location.port;l||(l=f?443:80),o=e.hostname!=location.hostname||l!=e.port,u=e.secure!=f}e.xdomain=o,e.xscheme=u,n=new r(e);if("open"in n&&!e.forceJSONP)return new i(e);if(!a)throw new Error("JSONP disabled");return new s(e)}var r=e("xmlhttprequest"),i=e("./polling-xhr"),s=e("./polling-jsonp"),o=e("./websocket");n.polling=u,n.websocket=o}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(e,t,n){(function(n){function f(){}function l(e){r.call(this,e),this.query=this.query||{},u||(n.___eio||(n.___eio=[]),u=n.___eio),this.index=u.length;var t=this;u.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=f)},!1)}var r=e("./polling"),i=e("component-inherit");t.exports=l;var s=/\n/g,o=/\\n/g,u,a=0;i(l,r),l.prototype.supportsBinary=!1,l.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},l.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},l.prototype.doWrite=function(e,t){function f(){l(),t()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';a=document.createElement(t)}catch(e){a=document.createElement("iframe"),a.name=n.iframeId,a.src="javascript:0"}a.id=n.iframeId,n.form.appendChild(a),n.iframe=a}var n=this;if(!this.form){var r=document.createElement("form"),i=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index,a;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=u,r.method="POST",r.setAttribute("accept-charset","utf-8"),i.name="d",r.appendChild(i),document.body.appendChild(r),this.form=r,this.area=i}this.form.action=this.uri(),l(),e=e.replace(o,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(c){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){n.iframe.readyState=="complete"&&f()}:this.iframe.onload=f}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(e,t,n){(function(n){function a(){}function f(e){i.call(this,e);if(n.location){var t="https:"==location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!=n.location.hostname||r!=e.port,this.xs=e.secure!=t}}function l(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=undefined!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.create()}function c(){for(var e in l.requests)l.requests.hasOwnProperty(e)&&l.requests[e].abort()}var r=e("xmlhttprequest"),i=e("./polling"),s=e("component-emitter"),o=e("component-inherit"),u=e("debug")("engine.io-client:polling-xhr");t.exports=f,t.exports.Request=l,o(f,i),f.prototype.supportsBinary=!0,f.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,new l(e)},f.prototype.doWrite=function(e,t){var n=typeof e!="string"&&e!==undefined,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},f.prototype.doPoll=function(){u("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},s(l.prototype),l.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new r(e),i=this;try{u("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async),this.supportsBinary&&(t.responseType="arraybuffer");if("POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){i.onLoad()},t.onerror=function(){i.onError(t.responseText)}):t.onreadystatechange=function(){if(4!=t.readyState)return;200==t.status||1223==t.status?i.onLoad():setTimeout(function(){i.onError(t.status)},0)},u("xhr data %s",this.data),t.send(this.data)}catch(s){setTimeout(function(){i.onError(s)},0);return}n.document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},l.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},l.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},l.prototype.cleanup=function(e){if("undefined"==typeof this.xhr||null===this.xhr)return;this.hasXDR()?this.xhr.onload=this.xhr.onerror=a:this.xhr.onreadystatechange=a;if(e)try{this.xhr.abort()}catch(t){}n.document&&delete l.requests[this.index],this.xhr=null},l.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}t==="application/octet-stream"?e=this.xhr.response:this.supportsBinary?e="ok":e=this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},l.prototype.hasXDR=function(){return"undefined"!=typeof n.XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},n.document&&(l.requestsCount=0,l.requests={},n.attachEvent?n.attachEvent("onunload",c):n.addEventListener&&n.addEventListener("beforeunload",c,!1))}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(e,t,n){function f(e){var t=e&&e.forceBase64;if(!a||t)this.supportsBinary=!1;r.call(this,e)}var r=e("../transport"),i=e("parseqs"),s=e("engine.io-parser"),o=e("component-inherit"),u=e("debug")("engine.io-client:polling");t.exports=f;var a=function(){var t=e("xmlhttprequest"),n=new t({xdomain:!1});return null!=n.responseType}();o(f,r),f.prototype.name="polling",f.prototype.doOpen=function(){this.poll()},f.prototype.pause=function(e){function r(){u("paused"),n.readyState="paused",e()}var t=0,n=this;this.readyState="pausing";if(this.polling||!this.writable){var i=0;this.polling&&(u("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){u("pre-pause polling complete"),--i||r()})),this.writable||(u("we are currently writing - waiting to pause"),i++,this.once("drain",function(){u("pre-pause writing complete"),--i||r()}))}else r()},f.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},f.prototype.onData=function(e){var t=this;u("polling got data %s",e);var n=function(e,n,r){"opening"==t.readyState&&t.onOpen();if("close"==e.type)return t.onClose(),!1;t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},f.prototype.doClose=function(){function t(){u("writing close packet"),e.write([{type:"close"}])}var e=this;"open"==this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},f.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")},t=this;s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+(new Date)+"-"+r.timestamps++),!this.supportsBinary&&!e.sid&&(e.b64=1),e=i.encode(e),this.port&&("https"==t&&this.port!=443||"http"==t&&this.port!=80)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:33,xmlhttprequest:20}],19:[function(e,t,n){function f(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),r.call(this,e)}var r=e("../transport"),i=e("engine.io-parser"),s=e("parseqs"),o=e("component-inherit"),u=e("debug")("engine.io-client:websocket"),a=e("ws");t.exports=f,o(f,r),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(!this.check())return;var e=this,t=this.uri(),n=void 0,r={agent:this.agent};r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized,this.ws=new a(t,n,r),this.ws.binaryType===undefined&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()},f.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(f.prototype.onData=function(e){var t=this;setTimeout(function(){r.prototype.onData.call(t,e)},0)}),f.prototype.write=function(e){function s(){t.writable=!0,t.emit("drain")}var t=this;this.writable=!1;for(var n=0,r=e.length;n<r;n++)i.encodePacket(e[n],this.supportsBinary,function(e){try{t.ws.send(e)}catch(n){u("websocket closed before onclose event")}});setTimeout(s,0)},f.prototype.onClose=function(){r.prototype.onClose.call(this)},f.prototype.doClose=function(){typeof this.ws!="undefined"&&this.ws.close()},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&this.port!=443||"ws"==t&&this.port!=80)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+(new Date)),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},f.prototype.check=function(){return!!a&&!("__initialize"in a&&this.name===f.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:33,ws:35}],20:[function(e,t,n){var r=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,i=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(s){}try{if("undefined"!=typeof XDomainRequest&&!n&&i)return new XDomainRequest}catch(s){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(s){}}},{"has-cors":38}],21:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],22:[function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,t=this.useColors;e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff);if(!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){if("%%"===e)return;i++,"%c"===e&&(s=i)}),e.splice(s,0,r),e}function s(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(t){}}function u(){var e;try{e=localStorage.debug}catch(t){}return e}n=t.exports=e("./debug"),n.log=s,n.formatArgs=i,n.save=o,n.load=u,n.useColors=r,n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(u())},{"./debug":23}],23:[function(e,t,n){function s(){return n.colors[r++%n.colors.length]}function o(e){function t(){}function r(){var e=r,t=+(new Date),o=t-(i||t);e.diff=o,e.prev=i,e.curr=t,i=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=s());var u=Array.prototype.slice.call(arguments);u[0]=n.coerce(u[0]),"string"!=typeof u[0]&&(u=["%o"].concat(u));var a=0;u[0]=u[0].replace(/%([a-z%])/g,function(t,r){if(t==="%%")return t;a++;var i=n.formatters[r];if("function"==typeof i){var s=u[a];t=i.call(e,s),u.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(u=n.formatArgs.apply(e,u));var f=r.log||n.log||console.log.bind(console);f.apply(e,u)}t.enabled=!1,r.enabled=!0;var o=n.enabled(e)?r:t;return o.namespace=e,o}function u(e){n.save(e);var t=(e||"").split(/[\s,]+/),r=t.length;for(var i=0;i<r;i++){if(!t[i])continue;e=t[i].replace(/\*/g,".*?"),e[0]==="-"?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$"))}}function a(){n.enable("")}function f(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=o,n.coerce=l,n.disable=a,n.enable=u,n.enabled=f,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var r=0,i},{ms:24}],24:[function(e,t,n){function a(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]),a=(t[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"y":return n*u;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"h":return n*s;case"minutes":case"minute":case"m":return n*i;case"seconds":case"second":case"s":return n*r;case"ms":return n}}function f(e){return e>=o?Math.round(e/o)+"d":e>=s?Math.round(e/s)+"h":e>=i?Math.round(e/i)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}function l(e){return c(e,o,"day")||c(e,s,"hour")||c(e,i,"minute")||c(e,r,"second")||e+" ms"}function c(e,t,n){if(e<t)return;return e<t*1.5?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var r=1e3,i=r*60,s=i*60,o=s*24,u=o*365.25;t.exports=function(e,t){return t=t||{},"string"==typeof e?a(e):t.long?l(e):f(e)}},{}],25:[function(e,t,n){(function(t){function m(e,t){var r="b"+n.packets[e.type]+e.data.data;return t(r)}function g(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=e.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=h[e.type];for(var u=0;u<s.length;u++)o[u+1]=s[u];return r(o.buffer)}function y(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,n.encodePacket(e,t,!0,r)},i.readAsArrayBuffer(e.data)}function b(e,t,r){if(!t)return n.encodeBase64Packet(e,r);if(c)return y(e,t,r);var i=new Uint8Array(1);i[0]=h[e.type];var s=new v([i.buffer,e.data]);return r(s)}function w(e,t,n){var r=new Array(e.length),i=u(e.length,n),s=function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})};for(var o=0;o<e.length;o++)s(o,e[o],i)}var r=e("./keys"),i=e("has-binary"),s=e("arraybuffer.slice"),o=e("base64-arraybuffer"),u=e("after"),a=e("utf8"),f=navigator.userAgent.match(/Android/i),l=/PhantomJS/i.test(navigator.userAgent),c=f||l;n.protocol=3;var h=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=r(h),d={type:"error",data:"parser error"},v=e("blob");n.encodePacket=function(e,n,r,i){"function"==typeof n&&(i=n,n=!1),"function"==typeof r&&(i=r,r=null);var s=e.data===undefined?undefined:e.data.buffer||e.data;if(t.ArrayBuffer&&s instanceof ArrayBuffer)return g(e,n,i);if(v&&s instanceof t.Blob)return b(e,n,i);if(s&&s.base64)return m(e,i);var o=h[e.type];return undefined!==e.data&&(o+=r?a.encode(String(e.data)):String(e.data)),i(""+o)},n.encodeBase64Packet=function(e,r){var i="b"+n.packets[e.type];if(v&&e.data instanceof v){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];r(i+e)},s.readAsDataURL(e.data)}var o;try{o=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(u){var a=new Uint8Array(e.data),f=new Array(a.length);for(var l=0;l<a.length;l++)f[l]=a[l];o=String.fromCharCode.apply(null,f)}return i+=t.btoa(o),r(i)},n.decodePacket=function(e,t,r){if(typeof e=="string"||e===undefined){if(e.charAt(0)=="b")return n.decodeBase64Packet(e.substr(1),t);if(r)try{e=a.decode(e)}catch(i){return d}var o=e.charAt(0);return Number(o)!=o||!p[o]?d:e.length>1?{type:p[o],data:e.substring(1)}:{type:p[o]}}var u=new Uint8Array(e),o=u[0],f=s(e,1);return v&&t==="blob"&&(f=new v([f])),{type:p[o],data:f}},n.decodeBase64Packet=function(e,n){var r=p[e.charAt(0)];if(!t.ArrayBuffer)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=o.decode(e.substr(1));return n==="blob"&&v&&(i=new v([i])),{type:r,data:i}},n.encodePayload=function(e,t,r){function o(e){return e.length+":"+e}function u(e,r){n.encodePacket(e,s?t:!1,!0,function(e){r(null,o(e))})}typeof t=="function"&&(r=t,t=null);var s=i(e);if(t&&s)return v&&!c?n.encodePayloadAsBlob(e,r):n.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");w(e,u,function(e,t){return r(t.join(""))})},n.decodePayload=function(e,t,r){if(typeof e!="string")return n.decodePayloadAsBinary(e,t,r);typeof t=="function"&&(r=t,t=null);var i;if(e=="")return r(d,0,1);var s="",o,u;for(var a=0,f=e.length;a<f;a++){var l=e.charAt(a);if(":"!=l)s+=l;else{if(""==s||s!=(o=Number(s)))return r(d,0,1);u=e.substr(a+1,o);if(s!=u.length)return r(d,0,1);if(u.length){i=n.decodePacket(u,t,!0);if(d.type==i.type&&d.data==i.data)return r(d,0,1);var c=r(i,a+o,f);if(!1===c)return}a+=o,s=""}}if(s!="")return r(d,0,1)},n.encodePayloadAsArrayBuffer=function(e,t){function r(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})}if(!e.length)return t(new ArrayBuffer(0));w(e,r,function(e,n){var r=n.reduce(function(e,t){var n;return typeof t=="string"?n=t.length:n=t.byteLength,e+n.toString().length+n+2},0),i=new Uint8Array(r),s=0;return n.forEach(function(e){var t=typeof e=="string",n=e;if(t){var r=new Uint8Array(e.length);for(var o=0;o<e.length;o++)r[o]=e.charCodeAt(o);n=r.buffer}t?i[s++]=0:i[s++]=1;var u=n.byteLength.toString();for(var o=0;o<u.length;o++)i[s++]=parseInt(u[o]);i[s++]=255;var r=new Uint8Array(n);for(var o=0;o<r.length;o++)i[s++]=r[o]}),t(i.buffer)})},n.encodePayloadAsBlob=function(e,t){function r(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);n[0]=1;if(typeof e=="string"){var r=new Uint8Array(e.length);for(var i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,n[0]=0}var s=e instanceof ArrayBuffer?e.byteLength:e.size,o=s.toString(),u=new Uint8Array(o.length+1);for(var i=0;i<o.length;i++)u[i]=parseInt(o[i]);u[o.length]=255;if(v){var a=new v([n.buffer,u.buffer,e]);t(null,a)}})}w(e,r,function(e,n){return t(new v(n))})},n.decodePayloadAsBinary=function(e,t,r){typeof t=="function"&&(r=t,t=null);var i=e,o=[],u=!1;while(i.byteLength>0){var a=new Uint8Array(i),f=a[0]===0,l="";for(var c=1;;c++){if(a[c]==255)break;if(l.length>310){u=!0;break}l+=a[c]}if(u)return r(d,0,1);i=s(i,2+l.length),l=parseInt(l);var h=s(i,0,l);if(f)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(p){var v=new Uint8Array(h);h="";for(var c=0;c<v.length;c++)h+=String.fromCharCode(v[c])}o.push(h),i=s(i,l)}var m=o.length;o.forEach(function(e,i){r(n.decodePacket(e,t,!0),i,m)})}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":36,utf8:31}],26:[function(e,t,n){t.exports=Object.keys||function(t){var n=[],r=Object.prototype.hasOwnProperty;for(var i in t)r.call(t,i)&&n.push(i);return n}},{}],27:[function(e,t,n){function r(e,t,n){function s(e,i){if(s.count<=0)throw new Error("after called too many times");--s.count,e?(r=!0,t(e),t=n):s.count===0&&!r&&t(null,i)}var r=!1;return n=n||i,s.count=e,e===0?t():s}function i(){}t.exports=r},{}],28:[function(e,t,n){t.exports=function(e,t,n){var r=e.byteLength;t=t||0,n=n||r;if(e.slice)return e.slice(t,n);t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r);if(t>=r||t>=n||r===0)return new ArrayBuffer(0);var i=new Uint8Array(e),s=new Uint8Array(n-t);for(var o=t,u=0;o<n;o++,u++)s[u]=i[o];return s.buffer}},{}],29:[function(e,t,n){(function(e){"use strict";n.encode=function(t){var n=new Uint8Array(t),r,i=n.length,s="";for(r=0;r<i;r+=3)s+=e[n[r]>>2],s+=e[(n[r]&3)<<4|n[r+1]>>4],s+=e[(n[r+1]&15)<<2|n[r+2]>>6],s+=e[n[r+2]&63];return i%3===2?s=s.substring(0,s.length-1)+"=":i%3===1&&(s=s.substring(0,s.length-2)+"=="),s},n.decode=function(t){var n=t.length*.75,r=t.length,i,s=0,o,u,a,f;t[t.length-1]==="="&&(n--,t[t.length-2]==="="&&n--);var l=new ArrayBuffer(n),c=new Uint8Array(l);for(i=0;i<r;i+=4)o=e.indexOf(t[i]),u=e.indexOf(t[i+1]),a=e.indexOf(t[i+2]),f=e.indexOf(t[i+3]),c[s++]=o<<2|u>>4,c[s++]=(u&15)<<4|a>>2,c[s++]=(a&3)<<6|f&63;return l}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(e,t,n){(function(e){function o(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function u(e,t){t=t||{};var r=new n;o(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function a(e,t){return o(e),new Blob(e,t||{})}var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,r=function(){try{var e=new Blob(["hi"]);return e.size===2}catch(t){return!1}}(),i=r&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return e.size===2}catch(t){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;t.exports=function(){return r?i?e.Blob:a:s?u:undefined}()}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],31:[function(t,n,r){(function(t){(function(i){function f(e){var t=[],n=0,r=e.length,i,s;while(n<r)i=e.charCodeAt(n++),i>=55296&&i<=56319&&n<r?(s=e.charCodeAt(n++),(s&64512)==56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),n--)):t.push(i);return t}function l(e){var t=e.length,n=-1,r,i="";while(++n<t)r=e[n],r>65535&&(r-=65536,i+=a(r>>>10&1023|55296),r=56320|r&1023),i+=a(r);return i}function c(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function h(e,t){return a(e>>t&63|128)}function p(e){if((e&4294967168)==0)return a(e);var t="";return(e&4294965248)==0?t=a(e>>6&31|192):(e&4294901760)==0?(c(e),t=a(e>>12&15|224),t+=h(e,6)):(e&4292870144)==0&&(t=a(e>>18&7|240),t+=h(e,12),t+=h(e,6)),t+=a(e&63|128),t}function d(e){var t=f(e),n=t.length,r=-1,i,s="";while(++r<n)i=t[r],s+=p(i);return s}function v(){if(b>=y)throw Error("Invalid byte index");var e=g[b]&255;b++;if((e&192)==128)return e&63;throw Error("Invalid continuation byte")}function m(){var e,t,n,r,i;if(b>y)throw Error("Invalid byte index");if(b==y)return!1;e=g[b]&255,b++;if((e&128)==0)return e;if((e&224)==192){var t=v();i=(e&31)<<6|t;if(i>=128)return i;throw Error("Invalid continuation byte")}if((e&240)==224){t=v(),n=v(),i=(e&15)<<12|t<<6|n;if(i>=2048)return c(i),i;throw Error("Invalid continuation byte")}if((e&248)==240){t=v(),n=v(),r=v(),i=(e&15)<<18|t<<12|n<<6|r;if(i>=65536&&i<=1114111)return i}throw Error("Invalid UTF-8 detected")}function w(e){g=f(e),y=g.length,b=0;var t=[],n;while((n=m())!==!1)t.push(n);return l(t)}var s=typeof r=="object"&&r,o=typeof n=="object"&&n&&n.exports==s&&n,u=typeof t=="object"&&t;if(u.global===u||u.window===u)i=u;var a=String.fromCharCode,g,y,b,E={version:"2.0.0",encode:d,decode:w};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd)e(function(){return E});else if(s&&!s.nodeType)if(o)o.exports=E;else{var S={},x=S.hasOwnProperty;for(var T in E)x.call(E,T)&&(s[T]=E[T])}else i.utf8=E})(this)}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],32:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,o=/^\s+/,u=/\s+$/;t.exports=function(a){if("string"!=typeof a||!a)return null;a=a.replace(o,"").replace(u,"");if(e.JSON&&JSON.parse)return JSON.parse(a);if(n.test(a.replace(r,"@").replace(i,"]").replace(s,"")))return(new Function("return "+a))()}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],33:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){var t={},n=e.split("&");for(var r=0,i=n.length;r<i;r++){var s=n[r].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}},{}],34:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var n=t,s=t.indexOf("["),o=t.indexOf("]");s!=-1&&o!=-1&&(t=t.substring(0,s)+t.substring(s,o).replace(/:/g,";")+t.substring(o,t.length));var u=r.exec(t||""),a={},f=14;while(f--)a[i[f]]=u[f]||"";return s!=-1&&o!=-1&&(a.source=n,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},{}],35:[function(e,t,n){function s(e,t,n){var r;return t?r=new i(e,t):r=new i(e),r}var r=function(){return this}(),i=r.WebSocket||r.MozWebSocket;t.exports=i?s:null,i&&(s.prototype=i.prototype)},{}],36:[function(e,t,n){(function(n){function i(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(r(e)){for(var i=0;i<e.length;i++)if(t(e[i]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return!0}return!1}return t(e)}var r=e("isarray");t.exports=i}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{isarray:37}],37:[function(e,t,n){t.exports=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"}},{}],38:[function(e,t,n){var r=e("global");try{t.exports="XMLHttpRequest"in r&&"withCredentials"in new r.XMLHttpRequest}catch(i){t.exports=!1}},{global:39}],39:[function(e,t,n){t.exports=function(){return this}()},{}],40:[function(e,t,n){var r=[].indexOf;t.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],41:[function(e,t,n){var r=Object.prototype.hasOwnProperty;n.keys=Object.keys||function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(n);return t},n.values=function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(e[n]);return t},n.merge=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e},n.length=function(e){return n.keys(e).length},n.isEmpty=function(e){return 0==n.length(e)}},{}],42:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var n=r.exec(t||""),s={},o=14;while(o--)s[i[o]]=n[o]||"";return s}},{}],43:[function(e,t,n){(function(t){var r=e("isarray"),i=e("./is-buffer");n.deconstructPacket=function(e){function s(e){if(!e)return e;if(i(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(r(e)){var o=new Array(e.length);for(var u=0;u<e.length;u++)o[u]=s(e[u]);return o}if("object"!=typeof e||e instanceof Date)return e;var o={};for(var a in e)o[a]=s(e[a]);return o}var t=[],n=e.data,o=e;return o.data=s(n),o.attachments=t.length,{packet:o,buffers:t}},n.reconstructPacket=function(e,t){function i(e){if(e&&e._placeholder){var n=t[e.num];return n}if(r(e)){for(var s=0;s<e.length;s++)e[s]=i(e[s]);return e}if(e&&"object"==typeof e){for(var o in e)e[o]=i(e[o]);return e}return e}var n=0;return e.data=i(e.data),e.attachments=undefined,e},n.removeBlobs=function(e,n){function s(e,a,f){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){o++;var l=new FileReader;l.onload=function(){f?f[a]=this.result:u=this.result,--o||n(u)},l.readAsArrayBuffer(e)}else if(r(e))for(var c=0;c<e.length;c++)s(e[c],c,e);else if(e&&"object"==typeof e&&!i(e))for(var h in e)s(e[h],h,e)}var o=0,u=e;s(u),o||n(u)}}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./is-buffer":45,isarray:46}],44:[function(e,t,n){function f(){}function l(e){var t="",s=!1;t+=e.type;if(n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)t+=e.attachments,t+="-";return e.nsp&&"/"!=e.nsp&&(s=!0,t+=e.nsp),null!=e.id&&(s&&(t+=",",s=!1),t+=e.id),null!=e.data&&(s&&(t+=","),t+=i.stringify(e.data)),r("encoded %j as %s",e,t),t}function c(e,t){function n(e){var n=u.deconstructPacket(e),r=l(n.packet),i=n.buffers;i.unshift(r),t(i)}u.removeBlobs(e,n)}function h(){this.reconstructor=null}function p(e){var t={},s=0;t.type=Number(e.charAt(0));if(null==n.types[t.type])return v();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){var o="";while(e.charAt(++s)!="-"){o+=e.charAt(s);if(s==e.length)break}if(o!=Number(o)||e.charAt(s)!="-")throw new Error("Illegal attachments");t.attachments=Number(o)}if("/"==e.charAt(s+1)){t.nsp="";while(++s){var u=e.charAt(s);if(","==u)break;t.nsp+=u;if(s==e.length)break}}else t.nsp="/";var a=e.charAt(s+1);if(""!==a&&Number(a)==a){t.id="";while(++s){var u=e.charAt(s);if(null==u||Number(u)!=u){--s;break}t.id+=e.charAt(s);if(s==e.length)break}t.id=Number(t.id)}if(e.charAt(++s))try{t.data=i.parse(e.substr(s))}catch(f){return v()}return r("decoded %s as %j",e,t),t}function d(e){this.reconPack=e,this.buffers=[]}function v(e){return{type:n.ERROR,data:"parser error"}}var r=e("debug")("socket.io-parser"),i=e("json3"),s=e("isarray"),o=e("component-emitter"),u=e("./binary"),a=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=f,n.Decoder=h,f.prototype.encode=function(e,t){r("encoding packet %j",e);if(n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)c(e,t);else{var i=l(e);t([i])}},o(h.prototype),h.prototype.add=function(e){var t;if("string"==typeof e)t=p(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new d(t),this.reconstructor.reconPack.attachments===0&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,this.emit("decoded",t))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){this.buffers.push(e);if(this.buffers.length==this.reconPack.attachments){var t=u.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":43,"./is-buffer":45,"component-emitter":9,debug:10,isarray:46,json3:47}],45:[function(e,t,n){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(this,typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],46:[function(e,t,n){t.exports=e(37)},{}],47:[function(t,n,r){(function(t){function h(e){if(h[e]!==o)return h[e];var t;if(e=="bug-string-char-index")t="a"[0]!="a";else if(e=="json")t=h("json-stringify")&&h("json-parse");else{var r,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(e=="json-stringify"){var s=f.stringify,u=typeof s=="function"&&l;if(u){(r=function(){return 1}).toJSON=r;try{u=s(0)==="0"&&s(new Number)==="0"&&s(new String)=='""'&&s(n)===o&&s(o)===o&&s()===o&&s(r)==="1"&&s([r])=="[1]"&&s([o])=="[null]"&&s(null)=="null"&&s([o,n,null])=="[null,null,null]"&&s({a:[r,true,false,null,"\0\b\n\f\r	"]})==i&&s(null,r)==="1"&&s([1,2],null,1)=="[\n 1,\n 2\n]"&&s(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&s(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&s(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&s(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(a){u=!1}}t=u}if(e=="json-parse"){var c=f.parse;if(typeof c=="function")try{if(c("0")===0&&!c(!1)){r=c(i);var p=r["a"].length==5&&r.a[0]===1;if(p){try{p=!c('"	"')}catch(a){}if(p)try{p=c("01")!==1}catch(a){}if(p)try{p=c("1.")!==1}catch(a){}}}}catch(a){p=!1}t=p}}return h[e]=!!t}var n={}.toString,i,s,o,u=typeof e=="function"&&e.amd,a=typeof JSON=="object"&&JSON,f=typeof r=="object"&&r&&!r.nodeType&&r;f&&a?(f.stringify=a.stringify,f.parse=a.parse):f=t.JSON=a||{};var l=new Date(-0xc782b5b800cec);try{l=l.getUTCFullYear()==-109252&&l.getUTCMonth()===0&&l.getUTCDate()===1&&l.getUTCHours()==10&&l.getUTCMinutes()==37&&l.getUTCSeconds()==6&&l.getUTCMilliseconds()==708}catch(c){}if(!h("json")){var p="[object Function]",d="[object Date]",v="[object Number]",m="[object String]",g="[object Array]",y="[object Boolean]",b=h("bug-string-char-index");if(!l)var w=Math.floor,E=[0,31,59,90,120,151,181,212,243,273,304,334],S=function(e,t){return E[t]+365*(e-1970)+w((e-1969+(t=+(t>1)))/4)-w((e-1901+t)/100)+w((e-1601+t)/400)};(i={}.hasOwnProperty)||(i=function(e){var t={},r;return(t.__proto__=null,t.__proto__={toString:1},t).toString!=n?i=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(r=t.constructor,i=function(e){var t=(this.constructor||r).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,i.call(this,e)});var x={"boolean":1,number:1,string:1,"undefined":1},T=function(e,t){var n=typeof e[t];return n=="object"?!!e[t]:!x[n]};s=function(e,t){var r=0,o,u,a;(o=function(){this.valueOf=0}).prototype.valueOf=0,u=new o;for(a in u)i.call(u,a)&&r++;return o=u=null,r?r==2?s=function(e,t){var r={},s=n.call(e)==p,o;for(o in e)(!s||o!="prototype")&&!i.call(r,o)&&(r[o]=1)&&i.call(e,o)&&t(o)}:s=function(e,t){var r=n.call(e)==p,s,o;for(s in e)(!r||s!="prototype")&&i.call(e,s)&&!(o=s==="constructor")&&t(s);(o||i.call(e,s="constructor"))&&t(s)}:(u=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],s=function(e,t){var r=n.call(e)==p,s,o,a=!r&&typeof e.constructor!="function"&&T(e,"hasOwnProperty")?e.hasOwnProperty:i;for(s in e)(!r||s!="prototype")&&a.call(e,s)&&t(s);for(o=u.length;s=u[--o];a.call(e,s)&&t(s));}),s(e,t)};if(!h("json-stringify")){var N={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},C="000000",k=function(e,t){return(C+(t||0)).slice(-e)},L="\\u00",A=function(e){var t='"',n=0,r=e.length,i=r>10&&b,s;i&&(s=e.split(""));for(;n<r;n++){var o=e.charCodeAt(n);switch(o){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=N[o];break;default:if(o<32){t+=L+k(2,o.toString(16));break}t+=i?s[n]:b?e.charAt(n):e[n]}}return t+'"'},O=function(e,t,r,u,a,f,l){var c,h,p,b,E,x,T,N,C,L,M,_,D,P,H,B;try{c=t[e]}catch(j){}if(typeof c=="object"&&c){h=n.call(c);if(h==d&&!i.call(c,"toJSON"))if(c>-1/0&&c<1/0){if(S){E=w(c/864e5);for(p=w(E/365.2425)+1970-1;S(p+1,0)<=E;p++);for(b=w((E-S(p,0))/30.42);S(p,b+1)<=E;b++);E=1+E-S(p,b),x=(c%864e5+864e5)%864e5,T=w(x/36e5)%24,N=w(x/6e4)%60,C=w(x/1e3)%60,L=x%1e3}else p=c.getUTCFullYear(),b=c.getUTCMonth(),E=c.getUTCDate(),T=c.getUTCHours(),N=c.getUTCMinutes(),C=c.getUTCSeconds(),L=c.getUTCMilliseconds();c=(p<=0||p>=1e4?(p<0?"-":"+")+k(6,p<0?-p:p):k(4,p))+"-"+k(2,b+1)+"-"+k(2,E)+"T"+k(2,T)+":"+k(2,N)+":"+k(2,C)+"."+k(3,L)+"Z"}else c=null;else typeof c.toJSON=="function"&&(h!=v&&h!=m&&h!=g||i.call(c,"toJSON"))&&(c=c.toJSON(e))}r&&(c=r.call(t,e,c));if(c===null)return"null";h=n.call(c);if(h==y)return""+c;if(h==v)return c>-1/0&&c<1/0?""+c:"null";if(h==m)return A(""+c);if(typeof c=="object"){for(P=l.length;P--;)if(l[P]===c)throw TypeError();l.push(c),M=[],H=f,f+=a;if(h==g){for(D=0,P=c.length;D<P;D++)_=O(D,c,r,u,a,f,l),M.push(_===o?"null":_);B=M.length?a?"[\n"+f+M.join(",\n"+f)+"\n"+H+"]":"["+M.join(",")+"]":"[]"}else s(u||c,function(e){var t=O(e,c,r,u,a,f,l);t!==o&&M.push(A(e)+":"+(a?" ":"")+t)}),B=M.length?a?"{\n"+f+M.join(",\n"+f)+"\n"+H+"}":"{"+M.join(",")+"}":"{}";return l.pop(),B}};f.stringify=function(e,t,r){var i,s,o,u;if(typeof t=="function"||typeof t=="object"&&t)if((u=n.call(t))==p)s=t;else if(u==g){o={};for(var a=0,f=t.length,l;a<f;l=t[a++],(u=n.call(l),u==m||u==v)&&(o[l]=1));}if(r)if((u=n.call(r))==v){if((r-=r%1)>0)for(i="",r>10&&(r=10);i.length<r;i+=" ");}else u==m&&(i=r.length<=10?r:r.slice(0,10));return O("",(l={},l[""]=e,l),s,o,i,"",[])}}if(!h("json-parse")){var M=String.fromCharCode,_={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},D,P,H=function(){throw D=P=null,SyntaxError()},B=function(){var e=P,t=e.length,n,r,i,s,o;while(D<t){o=e.charCodeAt(D);switch(o){case 9:case 10:case 13:case 32:D++;break;case 123:case 125:case 91:case 93:case 58:case 44:return n=b?e.charAt(D):e[D],D++,n;case 34:for(n="@",D++;D<t;){o=e.charCodeAt(D);if(o<32)H();else if(o==92){o=e.charCodeAt(++D);switch(o){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:n+=_[o],D++;break;case 117:r=++D;for(i=D+4;D<i;D++)o=e.charCodeAt(D),o>=48&&o<=57||o>=97&&o<=102||o>=65&&o<=70||H();n+=M("0x"+e.slice(r,D));break;default:H()}}else{if(o==34)break;o=e.charCodeAt(D),r=D;while(o>=32&&o!=92&&o!=34)o=e.charCodeAt(++D);n+=e.slice(r,D)}}if(e.charCodeAt(D)==34)return D++,n;H();default:r=D,o==45&&(s=!0,o=e.charCodeAt(++D));if(o>=48&&o<=57){o==48&&(o=e.charCodeAt(D+1),o>=48&&o<=57)&&H(),s=!1;for(;D<t&&(o=e.charCodeAt(D),o>=48&&o<=57);D++);if(e.charCodeAt(D)==46){i=++D;for(;i<t&&(o=e.charCodeAt(i),o>=48&&o<=57);i++);i==D&&H(),D=i}o=e.charCodeAt(D);if(o==101||o==69){o=e.charCodeAt(++D),(o==43||o==45)&&D++;for(i=D;i<t&&(o=e.charCodeAt(i),o>=48&&o<=57);i++);i==D&&H(),D=i}return+e.slice(r,D)}s&&H();if(e.slice(D,D+4)=="true")return D+=4,!0;if(e.slice(D,D+5)=="false")return D+=5,!1;if(e.slice(D,D+4)=="null")return D+=4,null;H()}}return"$"},j=function(e){var t,n;e=="$"&&H();if(typeof e=="string"){if((b?e.charAt(0):e[0])=="@")return e.slice(1);if(e=="["){t=[];for(;;n||(n=!0)){e=B();if(e=="]")break;n&&(e==","?(e=B(),e=="]"&&H()):H()),e==","&&H(),t.push(j(e))}return t}if(e=="{"){t={};for(;;n||(n=!0)){e=B();if(e=="}")break;n&&(e==","?(e=B(),e=="}"&&H()):H()),(e==","||typeof e!="string"||(b?e.charAt(0):e[0])!="@"||B()!=":")&&H(),t[e.slice(1)]=j(B())}return t}H()}return e},F=function(e,t,n){var r=I(e,t,n);r===o?delete e[t]:e[t]=r},I=function(e,t,r){var i=e[t],o;if(typeof i=="object"&&i)if(n.call(i)==g)for(o=i.length;o--;)F(i,o,r);else s(i,function(e){F(i,e,r)});return r.call(e,t,i)};f.parse=function(e,t){var r,i;return D=0,P=""+e,r=j(B()),B()!="$"&&H(),D=P=null,t&&n.call(t)==p?I((i={},i[""]=r,i),"",t):r}}}u&&e(function(){return f})})(this)},{}],48:[function(e,t,n){function r(e,t){var n=[];t=t||0;for(var r=t||0;r<e.length;r++)n[r-t]=e[r];return n}t.exports=r},{}]},{},[1])(1)});var PlayUI=qc.defineBehaviour("qc.engine.PlayUI",qc.Behaviour,function(){this.startBtn=null,this.currentScore=0,this.round=0,this.currentLandlord=null,this.dealTimer=null,window.playUI=this},{startBtn:qc.Serializer.NODE,ownCardContainer:qc.Serializer.NODE,hiddenContainer:qc.Serializer.NODE,cardPrefab:qc.Serializer.PREFAB,msgPrefab:qc.Serializer.PREFAB,scoreOne:qc.Serializer.NODE,scoreTwo:qc.Serializer.NODE,scoreThree:qc.Serializer.NODE,scoreZero:qc.Serializer.NODE,scorePanel:qc.Serializer.NODE,ratePanel:qc.Serializer.NODE,leftPlayerArea:qc.Serializer.NODE,rightPlayerArea:qc.Serializer.NODE,ownPlayerArea:qc.Serializer.NODE,exitBtn:qc.Serializer.NODE,mainScene:qc.Serializer.STRING});PlayUI.prototype.awake=function(){var e=this;e.leftPlayerArea.getScript("qc.engine.PlayerUI").player=G.leftPlayer,e.rightPlayerArea.getScript("qc.engine.PlayerUI").player=G.rightPlayer,e.ownPlayerArea.getScript("qc.engine.PlayerUI").player=G.ownPlayer,e.reDrawScore(),e.addListener(e.startBtn.onClick,e.startGame,e),e.addListener(e.scoreOne.onClick,function(){e.playerProvideScore(1)},e),e.addListener(e.scoreTwo.onClick,function(){e.playerProvideScore(2)},e),e.addListener(e.scoreThree.onClick,function(){e.playerProvideScore(3)},e),e.addListener(e.scoreZero.onClick,function(){e.playerProvideScore(4)},e),e.addListener(e.exitBtn.onClick,function(){e.dealTimer&&(e.game.timer.remove(e.dealTimer),e.dealTimer=null),e.game.state.load(e.mainScene,!1,function(){},function(){console.log(e.mainScene+"场景加载完毕。")})},e)},PlayUI.prototype.startGame=function(){var e=this;for(var t=0;t<G.currentCards.length;t++)G.currentCards[t].destroy();G.currentCards=[],G.hiddenCards=[],G.ownPlayer.cardList=[],G.leftPlayer.cardList=[],G.rightPlayer.cardList=[],e.currentScore=0,e.round=0,e.currentLandlord=null,e.scorePanel.text="0",e.ratePanel.text="1",e.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,e.leftPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,e.rightPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,e.reDraw(),e.startBtn.visible=!1,window.landlordUI.roundWinner=null,window.landlordUI.hideBtn(),window.landlordUI.cleanAllPlayArea(),window.landlordUI.cue.visible=!1;for(t=0;t<e.hiddenContainer.children.length;t++)e.hiddenContainer.children[t].frame="bg.jpg";e.dealCards()},PlayUI.prototype.robLandlord=function(){var e=this,t=G.gameRule.random(1,3),n=t===1?G.ownPlayer:t==2?G.rightPlayer:G.leftPlayer;e.provideScore(n)},PlayUI.prototype.provideScore=function(e){var t=this;e.isAI?(t.scoreThree.visible=!1,t.scoreTwo.visible=!1,t.scoreOne.visible=!1,t.scoreZero.visible=!1,t.game.timer.add(1e3,function(){var n=(new AILogic(e)).judgeScore(),r=e.nextPlayer.isAI?window.landlordUI.rightCards:window.landlordUI.leftCards;if(n<4&&n>t.currentScore){console.info(e.name+":叫"+n),t.currentScore=n,t.scorePanel.text=n+"",t.currentLandlord=e;for(var i=0;i<r.children.length;i++)r.children[i].destroy();var s=t.game.add.clone(t.msgPrefab,r);s.text=n+"分";if(n===3){t.setLandlord(e);return}}else{var s=t.game.add.clone(t.msgPrefab,r);s.text="不叫",console.info(e.name+"没有叫分抢地主")}++t.round===3?t.currentLandlord?t.setLandlord(t.currentLandlord):(t.showRestartMesg(),t.startGame()):t.provideScore(e.nextPlayer)})):(t.scoreZero.visible=!0,t.scoreThree.visible=!0,t.currentScore<2&&(t.scoreTwo.visible=!0),t.currentScore<1&&(t.scoreOne.visible=!0))},PlayUI.prototype.playerProvideScore=function(e){var t=this;if(e<4){t.currentScore=e,t.scorePanel.text=e+"",t.currentLandlord=G.ownPlayer;var n=t.game.add.clone(t.msgPrefab,window.landlordUI.ownCards);n.text=e+"分";if(e===3){t.setLandlord(G.ownPlayer);return}}else{var n=t.game.add.clone(t.msgPrefab,window.landlordUI.ownCards);n.text="不叫"}++t.round===3?t.currentLandlord?t.setLandlord(t.currentLandlord):(t.showRestartMesg(),t.startGame()):t.provideScore(G.ownPlayer.nextPlayer)},PlayUI.prototype.dealCards=function(){var e=this,t=G.cardMgr.getNewCards();for(var n=0;n<3;n++)G.hiddenCards.push(e.getOneCard(t));var r=17,i=function(){card=e.getOneCard(t),G.leftPlayer.cardList.push(card);var s=e.game.add.clone(e.cardPrefab,e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer);s.visible=!0,s.interactive=!1,card=e.getOneCard(t),G.rightPlayer.cardList.push(card),s=e.game.add.clone(e.cardPrefab,e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer),s.visible=!0,s.interactive=!1,card=e.getOneCard(t),G.ownPlayer.cardList.push(card),e.insertOneCard(card);if(--r>0)e.dealTimer=e.game.timer.add(200,i);else{G.leftPlayer.cardList.sort(G.gameRule.cardSort),G.rightPlayer.cardList.sort(G.gameRule.cardSort),G.ownPlayer.cardList.sort(G.gameRule.cardSort);for(n=0;n<G.currentCards.length;n++)G.currentCards[n].getScript("qc.engine.CardUI").isSelected=!1;e.robLandlord()}};i()},PlayUI.prototype.getOneCard=function(e){var t=this;return e.splice(t.game.math.random(0,e.length-1),1)[0]},PlayUI.prototype.setLandlord=function(e){var t=this;t.scorePanel.text=t.currentScore+"",t.scoreThree.visible=!1,t.scoreTwo.visible=!1,t.scoreOne.visible=!1,t.scoreZero.visible=!1;var n=t.hiddenContainer.children;for(var r=0;r<t.hiddenContainer.children.length;r++)t.hiddenContainer.children[r].frame=G.hiddenCards[r].icon;G.ownPlayer.isLandlord=!1,G.leftPlayer.isLandlord=!1,G.rightPlayer.isLandlord=!1,e.isLandlord=!0,t.setAIStation(t.leftPlayerArea,G.leftPlayer.isLandlord),t.setAIStation(t.rightPlayerArea,G.rightPlayer.isLandlord),t.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.frame=G.ownPlayer.isLandlord?"landlord.png":"peasant.png",t.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!0,e.cardList=e.cardList.concat(G.hiddenCards),e.cardList.sort(G.gameRule.cardSort),t.reDraw();if(!e.isAI)for(r=0;r<G.hiddenCards.length;r++)t.insertOneCard(G.hiddenCards[r]);for(r=0;r<G.currentCards.length;r++)G.currentCards[r].getScript("qc.engine.CardUI").isSelected=!1;console.info("本轮地主是"+e.name),window.landlordUI.cleanAllPlayArea(),window.landlordUI.playCard(e)},PlayUI.prototype.insertOneCard=function(e){var t=this,n=0;if(G.currentCards.length!=0&&G.gameRule.cardSort(e,G.currentCards[0])===1)for(var r=0;r<G.currentCards.length;r++){var i=G.currentCards[r].getScript("qc.engine.CardUI").info,s=null;r<G.currentCards.length-1&&(s=G.currentCards[r+1].getScript("qc.engine.CardUI").info);if(G.gameRule.cardSort(e,i)===1&&(s&&G.gameRule.cardSort(e,s)===-1||!s)){n=r+1;break}}var o=t.game.add.clone(t.cardPrefab,t.ownCardContainer);o.getScript("qc.engine.CardUI").show(e,!0),t.ownCardContainer.setChildIndex(o,n),G.currentCards.splice(n,0,o)},PlayUI.prototype.setAIStation=function(e,t){var n=e.getScript("qc.engine.PlayerUI");n.headPic.frame=t?"landlord.png":"peasant.png",n.headPic.visible=!0},PlayUI.prototype.reDraw=function(){var e=this,t=function(t,n){var r=t.children.length-n;if(r>0)for(var i=0;i<r;i++)t.removeChild(t.children[0]);else{r=-r;for(var i=0;i<r;i++){var s=e.game.add.clone(e.cardPrefab,t);s.visible=!0,s.interactive=!1}}};t(e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,G.leftPlayer.cardList.length),t(e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,G.rightPlayer.cardList.length)},PlayUI.prototype.reDrawScore=function(){var e=this,t=e.ownPlayerArea.getScript("qc.engine.PlayerUI"),n=e.leftPlayerArea.getScript("qc.engine.PlayerUI"),r=e.rightPlayerArea.getScript("qc.engine.PlayerUI");t.playerScore.text=t.player.score+"分",n.playerScore.text=n.player.score+"分",r.playerScore.text=r.player.score+"分"},PlayUI.prototype.showAICards=function(){var e=this,t=e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,n=e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer;for(var r=0;r<t.children.length;r++)t.children[r].frame=G.leftPlayer.cardList[r].icon;for(r=0;r<n.children.length;r++)n.children[r].frame=G.rightPlayer.cardList[r].icon},PlayUI.prototype.showRestartMesg=function(){var e=this,t=window.landlordUI.cue;t.text=G.gameRule.MSG_NO_ROROB_RESTART,t.visible=!0,e.game.timer.add(1500,function(){t.visible=!1})};var CardlistUI=qc.defineBehaviour("qc.engine.CardlistUI",qc.Behaviour,function(){},{});CardlistUI.prototype.onDragStart=function(e){this.startX=this.gameObject.toLocal(new qc.Point(e.source.startX,e.source.startY)).x},CardlistUI.prototype.onDrag=function(e){},CardlistUI.prototype.onDragEnd=function(e){var t=this,n=this.gameObject.toLocal(new qc.Point(e.source.x,e.source.y)).x;if(n<t.startX){var r=n;n=t.startX,t.startX=r}for(var i=0;i<this.gameObject.children.length;i++){var s=this.gameObject.children[i],o=s.x,u=t.floatAdd(o,30),a=t.floatSub(t.startX,o),f=t.floatSub(u,n);(t.startX<o&&n>u||a<30&&a>=0||f<30&&f>=0)&&s.getScript("qc.engine.CardUI").onClick()}},CardlistUI.prototype.floatAdd=function(e,t){var n,r,i;try{n=e.toString().split(".")[1].length}catch(s){n=0}try{r=t.toString().split(".")[1].length}catch(s){r=0}return i=Math.pow(10,Math.max(n,r)),(e*i+t*i)/i},CardlistUI.prototype.floatSub=function(e,t){var n,r,i,s;try{n=e.toString().split(".")[1].length}catch(o){n=0}try{r=t.toString().split(".")[1].length}catch(o){r=0}return i=Math.pow(10,Math.max(n,r)),s=n>=r?n:r,((e*i-t*i)/i).toFixed(s)};var Card=qc.landlord.Card=function(){this.data=[{icon:"j1.jpg",type:"0",val:17},{icon:"j2.jpg",type:"0",val:16},{icon:"t1.jpg",type:"1",val:14},{icon:"t2.jpg",type:"1",val:15},{icon:"t3.jpg",type:"1",val:3},{icon:"t4.jpg",type:"1",val:4},{icon:"t5.jpg",type:"1",val:5},{icon:"t6.jpg",type:"1",val:6},{icon:"t7.jpg",type:"1",val:7},{icon:"t8.jpg",type:"1",val:8},{icon:"t9.jpg",type:"1",val:9},{icon:"t10.jpg",type:"1",val:10},{icon:"t11.jpg",type:"1",val:11},{icon:"t12.jpg",type:"1",val:12},{icon:"t13.jpg",type:"1",val:13},{icon:"x1.jpg",type:"2",val:14},{icon:"x2.jpg",type:"2",val:15},{icon:"x3.jpg",type:"2",val:3},{icon:"x4.jpg",type:"2",val:4},{icon:"x5.jpg",type:"2",val:5},{icon:"x6.jpg",type:"2",val:6},{icon:"x7.jpg",type:"2",val:7},{icon:"x8.jpg",type:"2",val:8},{icon:"x9.jpg",type:"2",val:9},{icon:"x10.jpg",type:"2",val:10},{icon:"x11.jpg",type:"2",val:11},{icon:"x12.jpg",type:"2",val:12},{icon:"x13.jpg",type:"2",val:13},{icon:"h1.jpg",type:"3",val:14},{icon:"h2.jpg",type:"3",val:15},{icon:"h3.jpg",type:"3",val:3},{icon:"h4.jpg",type:"3",val:4},{icon:"h5.jpg",type:"3",val:5},{icon:"h6.jpg",type:"3",val:6},{icon:"h7.jpg",type:"3",val:7},{icon:"h8.jpg",type:"3",val:8},{icon:"h9.jpg",type:"3",val:9},{icon:"h10.jpg",type:"3",val:10},{icon:"h11.jpg",type:"3",val:11},{icon:"h12.jpg",type:"3",val:12},{icon:"h13.jpg",type:"3",val:13},{icon:"k1.jpg",type:"4",val:14},{icon:"k2.jpg",type:"4",val:15},{icon:"k3.jpg",type:"4",val:3},{icon:"k4.jpg",type:"4",val:4},{icon:"k5.jpg",type:"4",val:5},{icon:"k6.jpg",type:"4",val:6},{icon:"k7.jpg",type:"4",val:7},{icon:"k8.jpg",type:"4",val:8},{icon:"k9.jpg",type:"4",val:9},{icon:"k10.jpg",type:"4",val:10},{icon:"k11.jpg",type:"4",val:11},{icon:"k12.jpg",type:"4",val:12},{icon:"k13.jpg",type:"4",val:13}]};Card.prototype.getNewCards=function(){return this.data.slice(0)};var LandlordUI=qc.defineBehaviour("qc.engine.LandlordUI",qc.Behaviour,function(){this.readyCards=[],this.noCardBtn=null,this.playBtn=null,this.winCard=null,this.roundWinner=null,this.promptTimes=0,this.promptList=null,window.landlordUI=this},{noCardBtn:qc.Serializer.NODE,cue:qc.Serializer.NODE,playBtn:qc.Serializer.NODE,warnBtn:qc.Serializer.NODE,ownCards:qc.Serializer.NODE,leftCards:qc.Serializer.NODE,rightCards:qc.Serializer.NODE,msgPrefab:qc.Serializer.PREFAB,cardPrefab:qc.Serializer.PREFAB});LandlordUI.prototype.awake=function(){function nocontextmenu(e){return e.cancelBubble=!0,e.returnValue=!1,!1}function norightclick(e){if(window.Event){if(e.which==2||e.which==3)return!1}else if(e.button==2||e.button==3)return e.cancelBubble=!0,e.returnValue=!1,!1}var self=this,input=self.game.input;window.Event&&window.document.captureEvents(Event.MOUSEUP),window.document.oncontextmenu=nocontextmenu,window.document.onmousedown=norightclick,this.addListener(self.playBtn.onClick,self.playEvent,this),this.addListener(input.onPointerDown,function(e,t,n){input=self.game.input;var r=input.getPointer(e);r.isMouse&&r.id===qc.Mouse.BUTTON_RIGHT&&self.playBtn.visible&&self.playEvent()},self),this.addListener(self.warnBtn.onClick,function(){if(self.promptList.length>0){var promptIndex=self.promptTimes++%self.promptList.length;self.takeBackCards();var list=self.promptList[promptIndex];for(var i=0;i<list.length;i++)for(var j=0;j<G.currentCards.length;j++)with(G.currentCards[j].getScript("qc.engine.CardUI"))list[i].val===info.val&&list[i].type===info.type&&(G.currentCards[j].anchoredY=-28,isSelected=!0);self.getReadyCardsKind()?self.playBtn.state=qc.UIState.NORMAL:self.playBtn.state=qc.UIState.DISABLED}else self.roundWinner.name!=G.ownPlayer.name&&self.notCardToPlay()}),this.addListener(self.noCardBtn.onClick,self.notCardToPlay,this)},LandlordUI.prototype.playEvent=function(){var e=this,t=e.getReadyCardsKind();if(t){if(t.cardKind===G.gameRule.BOMB||t.cardKind===G.gameRule.KING_BOMB){var n=parseInt(window.playUI.ratePanel.text);window.playUI.ratePanel.text=n*2+""}e.winCard=t,e.roundWinner=G.ownPlayer,e.addOwnCards(),e.hideBtn();if(G.ownPlayer.cardList.length===0){e.judgeWinner(G.ownPlayer);return}e.playCard(G.ownPlayer.nextPlayer)}},LandlordUI.prototype.takeBackCards=function(){for(var e=0;e<G.currentCards.length;e++)G.currentCards[e].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[e].anchoredY=0,G.currentCards[e].getScript("qc.engine.CardUI").isSelected=!1)},LandlordUI.prototype.notCardToPlay=function(){var e=this;e.hideBtn(),e.takeBackCards(),e.cue.visible=!1,e.game.add.clone(e.msgPrefab,e.ownCards),e.playCard(G.ownPlayer.nextPlayer)},LandlordUI.prototype.getReadyCardsKind=function(){var e=this;e.readyCards=[];for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&e.readyCards.push(G.currentCards[i].getScript("qc.engine.CardUI").info);if(e.readyCards.length===0)return null;var t=G.gameRule.typeJudge(e.readyCards);return t?e.roundWinner&&e.roundWinner.name!=G.ownPlayer.name?function(e,n){return n.cardKind===G.gameRule.KING_BOMB||n.cardKind===G.gameRule.BOMB&&e.cardKind!=G.gameRule.BOMB||n.cardKind===e.cardKind&&n.size===e.size&&n.val>e.val?t:null}(e.winCard,t):t:null},LandlordUI.prototype.addOwnCards=function(){var e=this,t=[];e.cleanPlayArea();for(i=G.currentCards.length-1;i>=0;i--)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[i].parent=e.ownCards,G.currentCards[i].interactive=!1,e.ownCards.setChildIndex(G.currentCards[i],0),G.currentCards.splice(i,1),G.ownPlayer.cardList.splice(i,1))},LandlordUI.prototype.cleanPlayArea=function(){var e=this.ownCards.children;for(var t=0;t<e.length;t++)e[t].destroy()},LandlordUI.prototype.cleanAllPlayArea=function(){this.cleanPlayArea();var e=this.leftCards.children,t=this.rightCards.children;for(var n=0;n<e.length;n++)e[n].destroy();for(n=0;n<t.length;n++)t[n].destroy()},LandlordUI.prototype.playCard=function(e){var t=this;if(e.isAI){console.info(e.name+"出牌中");var n=new qc.landlord.AILogic(e),r=e.nextPlayer.isAI?t.rightCards:t.leftCards;for(var i=0;i<r.children.length;i++)r.children[i].destroy();t.game.timer.add(1e3,function(){var s=null;!t.roundWinner||t.roundWinner.name==e.name?(t.cleanAllPlayArea(),s=n.play(window.playUI.currentLandlord.cardList.length)):s=n.follow(t.winCard,t.roundWinner.isLandlord,t.roundWinner.cardList.length);if(s){for(i=0;i<s.cardList.length;i++){var o=t.game.add.clone(t.cardPrefab,r);o.getScript("qc.engine.CardUI").show(s.cardList[i],!1),o.interactive=!1;for(var u=0;u<e.cardList.length;u++)if(e.cardList[u].val===s.cardList[i].val&&e.cardList[u].type===s.cardList[i].type){e.cardList.splice(u,1);break}}if(s.cardKind===G.gameRule.BOMB||s.cardKind===G.gameRule.KING_BOMB){var a=parseInt(window.playUI.ratePanel.text);window.playUI.ratePanel.text=a*2+""}t.roundWinner=e,delete s.cardList,t.winCard=s,window.playUI.reDraw()}else t.game.add.clone(t.msgPrefab,r);if(e.cardList.length===0){t.judgeWinner(e);return}t.playCard(e.nextPlayer)})}else{console.info("该你出了"),t.getReadyCardsKind()?t.playBtn.state=qc.UIState.NORMAL:t.playBtn.state=qc.UIState.DISABLED,t.playBtn.visible=!0,t.warnBtn.visible=!0,t.cleanPlayArea(),!t.roundWinner||t.roundWinner.name==e.name?t.winCard=null:t.noCardBtn.visible=!0,t.promptTimes=0;var n=new qc.landlord.AILogic(G.ownPlayer);t.promptList=n.prompt(t.winCard)}},LandlordUI.prototype.hideBtn=function(){this.noCardBtn.visible=!1,this.playBtn.visible=!1,this.warnBtn.visible=!1},LandlordUI.prototype.judgeWinner=function(e){var t=this;t.hideBtn();var n=parseInt(window.playUI.scorePanel.text)*parseInt(window.playUI.ratePanel.text);!e.isAI||!e.isLandlord&&!G.ownPlayer.isLandlord?(t.cue.text="你赢了",G.ownPlayer.isLandlord?(G.ownPlayer.score=G.ownPlayer.score+n*2,G.leftPlayer.score=G.leftPlayer.score-n,G.rightPlayer.score=G.rightPlayer.score-n):e.name==G.ownPlayer.name?(G.ownPlayer.score=G.ownPlayer.score+n,G.leftPlayer.isLandlord?(G.leftPlayer.score=G.leftPlayer.score-n*2,G.rightPlayer.score=G.rightPlayer.score+n):(G.leftPlayer.score=G.leftPlayer.score+n,G.rightPlayer.score=G.rightPlayer.score-n*2)):(G.ownPlayer.score=G.ownPlayer.score+n,e.score=e.score+n,window.playUI.currentLandlord.score=window.playUI.currentLandlord.score-2*n)):(t.cue.text="你输了",G.ownPlayer.isLandlord?(G.ownPlayer.score=G.ownPlayer.score-n*2,G.leftPlayer.score=G.leftPlayer.score+n,G.rightPlayer.score=G.rightPlayer.score+n):(G.ownPlayer.score=G.ownPlayer.score-n,G.leftPlayer.name===e.name?(G.leftPlayer.score=G.leftPlayer.score+n*2,G.rightPlayer.score=G.rightPlayer.score-n):(G.leftPlayer.score=G.leftPlayer.score-n,G.rightPlayer.score=G.rightPlayer.score+n*2))),window.playUI.reDrawScore(),t.cue.visible=!0,window.playUI.showAICards(),window.playUI.startBtn.visible=!0};var MainUI=qc.defineBehaviour("qc.engine.MainUI",qc.Behaviour,function(){this.singleBtn=null,this.multiBtn=null,this.singleScene=null},{singleBtn:qc.Serializer.NODE,multiBtn:qc.Serializer.NODE,enterNameBtn:qc.Serializer.NODE,backBtn:qc.Serializer.NODE,nameField:qc.Serializer.NODE,enterNamePanel:qc.Serializer.NODE,message:qc.Serializer.NODE,singleScene:qc.Serializer.STRING,multiScene:qc.Serializer.STRING});MainUI.prototype.awake=function(){var e=this;e.addListener(e.singleBtn.onClick,function(){e.game.state.load(e.singleScene,!1,function(){G.cardMgr=new qc.landlord.Card,G.ownPlayer=new qc.landlord.Player("QCPlayer"),G.ownPlayer.isAI=!1;var e=G.game.storage,t=e.get("QCPlayer");G.ownPlayer.score=t?t:500,G.leftPlayer=new qc.landlord.Player("AI_Left");var n=e.get("AI_Left");G.leftPlayer.score=n?n:500,G.rightPlayer=new qc.landlord.Player("AI_Right");var r=e.get("AI_Right");G.rightPlayer.score=r?r:500,G.ownPlayer.nextPlayer=G.rightPlayer,G.rightPlayer.nextPlayer=G.leftPlayer,G.leftPlayer.nextPlayer=G.ownPlayer,G.hiddenCards=[],G.currentCards=[]},function(){console.log(e.singleScene+"场景加载完毕。")})},e),e.addListener(e.multiBtn.onClick,function(){var t=G.game.storage.get("uid");if(t)e.showMessage(e.MSG_WAITING),e.enterGame(t);else{var n=e.enterNamePanel.getScript("qc.TweenAlpha");n.from=0,n.to=1,n.resetToBeginning(),e.enterNamePanel.visible=!0,n.playForward()}},e),e.addListener(e.enterNameBtn.onClick,function(){var t=e.nameField.text.trim();if(t){e.showMessage(e.MSG_WAITING);var n=G.online.register(t);n.then(function(t){t.uid?(G.game.storage.set("uid",t.uid),G.game.storage.save(),e.enterGame(t.uid)):err===G.online.ERR_EXIST_NAME&&e.showMessage(e.MSG_EXIST_NAME)}).catch(function(t){t===G.online.ERR_EXIST_NAME&&e.showMessage(e.MSG_EXIST_NAME)})}},e),e.addListener(e.backBtn.onClick,function(){var t=e.enterNamePanel.getScript("qc.TweenAlpha");t.from=1,t.to=0,t.resetToBeginning(),t.playForward(),t.onFinished.addOnce(function(){e.enterNamePanel.visible=!1},e),window.onbeforeunload=undefined},e)},MainUI.prototype.enterGame=function(e){var t=this;G.ownPlayer=new qc.landlord.Player(null),G.ownPlayer.uid=e,window.onbeforeunload=function(){var e="确认退出游戏?";return e},G.online.joinGame(G.ownPlayer.uid).then(function(e){var n=e.seats?e.seats[e.ownSeatNo]:e.desk.seats[e.ownSeatNo];G.ownPlayer.deskNo=n.deskNo,G.ownPlayer.name=n.name,G.ownPlayer.seatNo=e.ownSeatNo,G.netInitData=e,t.game.state.load(t.multiScene,!1,function(){},function(){console.log(t.multiScene+"场景加载完毕。")})})},MainUI.prototype.showMessage=function(e){var t=this;e?(t.message.text=e,t.message.visible=!0):t.message.visible=!1},MainUI.prototype.MSG_WAITING="请稍等",MainUI.prototype.MSG_EXIST_NAME="您输入的昵称已被使用，请重试";var ClockUI=qc.defineBehaviour("qc.engine.ClockUI",qc.Behaviour,function(){this.startTime=null},{timePanel:qc.Serializer.NODE,totalTime:qc.Serializer.NUMBER});ClockUI.prototype.awake=function(){var e=this;e.startTime=(new Date).getTime();var t=e.timer=e.game.timer.loop(200,function(){var t=(new Date).getTime(),n=Math.floor((t-e.startTime)/1e3),r=e.totalTime-n;e.timePanel.text=(r<0?0:r)+"",r<0&&e.game.timer.remove(e.timer)},e)};var OlLandlordUI=qc.defineBehaviour("qc.engine.OlLandlordUI",qc.Behaviour,function(){this.readyCards=[],this.noCardBtn=null,this.playBtn=null,this.winCard=null,this.roundWinner=null,this.promptTimes=0,this.promptList=null,window.olLandlordUI=this},{rate:qc.Serializer.NODE,cue:qc.Serializer.NODE,noCardBtn:qc.Serializer.NODE,playBtn:qc.Serializer.NODE,warnBtn:qc.Serializer.NODE,myPlayArea:qc.Serializer.NODE,leftPlayArea:qc.Serializer.NODE,rightPlayArea:qc.Serializer.NODE,msgPrefab:qc.Serializer.PREFAB,clockPrefab:qc.Serializer.PREFAB,cardPrefab:qc.Serializer.PREFAB});OlLandlordUI.prototype.awake=function(){function nocontextmenu(e){return e.cancelBubble=!0,e.returnValue=!1,!1}function norightclick(e){if(window.Event){if(e.which==2||e.which==3)return!1}else if(e.button==2||e.button==3)return e.cancelBubble=!0,e.returnValue=!1,!1}var self=this,input=self.game.input;window.Event&&window.document.captureEvents(Event.MOUSEUP),window.document.oncontextmenu=nocontextmenu,window.document.onmousedown=norightclick,this.addListener(self.playBtn.onClick,self.playEvent,this),this.addListener(input.onPointerDown,function(e,t,n){input=self.game.input;var r=input.getPointer(e);r.isMouse&&r.id===qc.Mouse.BUTTON_RIGHT&&self.playBtn.visible&&self.playEvent()},self),this.addListener(self.warnBtn.onClick,function(){if(self.promptList.length>0){var promptIndex=self.promptTimes++%self.promptList.length;self.takeBackCards();var list=self.promptList[promptIndex];for(var i=0;i<list.length;i++)for(var j=0;j<G.currentCards.length;j++)with(G.currentCards[j].getScript("qc.engine.CardUI"))list[i].val===info.val&&list[i].type===info.type&&(G.currentCards[j].anchoredY=-28,isSelected=!0);self.getReadyCardsKind()?self.playBtn.state=qc.UIState.NORMAL:self.playBtn.state=qc.UIState.DISABLED}else self.winCard&&self.notCardToPlay()}),this.addListener(self.noCardBtn.onClick,self.notCardToPlay,this)},OlLandlordUI.prototype.playEvent=function(){var e=this,t=e.getReadyCardsKind();t&&(e.winCard=t,e.addOwnCards(),e.hidePlayBtn(),t.cardList=e.readyCards,G.online.playCard(t),e._playTimer&&e.game.timer.remove(e._playTimer))},OlLandlordUI.prototype.takeBackCards=function(){for(var e=0;e<G.currentCards.length;e++)G.currentCards[e].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[e].anchoredY=0,G.currentCards[e].getScript("qc.engine.CardUI").isSelected=!1)},OlLandlordUI.prototype.notCardToPlay=function(){var e=this;e.hidePlayBtn(),e.takeBackCards(),e.cleanPlayArea(),e.game.add.clone(e.msgPrefab,e.myPlayArea),G.online.playCard(null),e._playTimer&&e.game.timer.remove(e._playTimer)},OlLandlordUI.prototype.getReadyCardsKind=function(){var e=this;e.readyCards=[];for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&e.readyCards.push(G.currentCards[i].getScript("qc.engine.CardUI").info);if(e.readyCards.length===0)return null;var t=G.gameRule.typeJudge(e.readyCards);return t?e.winCard?function(e,n){return n.cardKind===G.gameRule.KING_BOMB||n.cardKind===G.gameRule.BOMB&&e.cardKind!=G.gameRule.BOMB||n.cardKind===e.cardKind&&n.size===e.size&&n.val>e.val?t:null}(e.winCard,t):t:null},OlLandlordUI.prototype.addOwnCards=function(){var e=this,t=[];e.cleanPlayArea();for(i=G.currentCards.length-1;i>=0;i--)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[i].parent=e.myPlayArea,G.currentCards[i].interactive=!1,e.myPlayArea.setChildIndex(G.currentCards[i],0),G.currentCards.splice(i,1),G.ownPlayer.cardList.splice(i,1))},OlLandlordUI.prototype.cleanPlayArea=function(){var e=this.myPlayArea.children;for(var t=0;t<e.length;t++)e[t].destroy()},OlLandlordUI.prototype.cleanAllPlayArea=function(){this.cleanPlayArea();var e=this.leftPlayArea.children,t=this.rightPlayArea.children;for(var n=0;n<e.length;n++)e[n].destroy();for(n=0;n<t.length;n++)t[n].destroy()},OlLandlordUI.prototype.playTurn=function(e){var t=this;t.winCard=e.winCard,e.winCard||t.cleanAllPlayArea(),e.rate&&(t.rate.text=e.rate+"");if(e.preSeatNo&&e.preSeatNo!=G.ownPlayer.seatNo){var n=null,r=null;G.leftPlayer.seatNo===e.preSeatNo?(window.onlinePlayUI.cleanLeftPlayArea(),n=t.leftPlayArea,r=window.onlinePlayUI.left.getScript("qc.engine.OPlayerUI").cardContainer):(window.onlinePlayUI.cleanRightPlayArea(),n=t.rightPlayArea,r=window.onlinePlayUI.right.getScript("qc.engine.OPlayerUI").cardContainer),t.showPlayedCards(e.preCardInfo,n,r)}if(G.ownPlayer.seatNo===e.nextSeatNo){t.cleanPlayArea(),t.promptTimes=0,t.showPlayBtn(e.winCard?!1:!0);var i=new qc.landlord.AILogic(G.ownPlayer);t.promptList=i.prompt(t.winCard),t.game.add.clone(t.clockPrefab,t.myPlayArea),t.addPlayTimer()}else G.leftPlayer.seatNo===e.nextSeatNo?(window.onlinePlayUI.cleanLeftPlayArea(),t.game.add.clone(t.clockPrefab,t.leftPlayArea)):(window.onlinePlayUI.cleanRightPlayArea(),t.game.add.clone(t.clockPrefab,t.rightPlayArea))},OlLandlordUI.prototype.addPlayTimer=function(){var e=this;e._playTimer=e.game.timer.add(3e4,function(){e.warnBtn.onClick.dispatch(e.warnBtn),e.playBtn.state===qc.UIState.NORMAL?e.playBtn.onClick.dispatch(e.playBtn):e.notCardToPlay()})},OlLandlordUI.prototype.showPlayedCards=function(e,t,n,r){var i=this;for(var s=0;s<t.children.length;s++)t.children[s].destroy();if(e){for(s=0;s<e.cardList.length;s++){var o=i.game.add.clone(i.cardPrefab,t);o.visible=!0,o.interactive=!1,o.getScript("qc.engine.CardUI").show(e.cardList[s],!1)}if(!r)for(s=e.size-1;s>=0;s--)n.children[s].destroy()}else i.game.add.clone(i.msgPrefab,t)},OlLandlordUI.prototype.showPlayBtn=function(e){this.playBtn.visible=!0,this.getReadyCardsKind()?this.playBtn.state=qc.UIState.NORMAL:this.playBtn.state=qc.UIState.DISABLED,this.warnBtn.visible=!0,e||(this.noCardBtn.visible=!0)},OlLandlordUI.prototype.hidePlayBtn=function(){this.noCardBtn.visible=!1,this.playBtn.visible=!1,this.warnBtn.visible=!1},OlLandlordUI.prototype.judgeWinner=function(e){var t=this;t.hidePlayBtn(),t.rate.text=e.rate+"",e.winnerSeatNo!=G.ownPlayer.seatNo&&t.showPlayedCards(e.lastCards,e.winnerSeatNo===G.leftPlayer.seatNo?t.leftPlayArea:t.rightPlayArea,e.winnerSeatNo===G.leftPlayer.seatNo?window.onlinePlayUI.left.getScript("qc.engine.OPlayerUI").cardContainer:window.onlinePlayUI.right.getScript("qc.engine.OPlayerUI").cardContainer),e.winnerSeatNo===G.ownPlayer.seatNo||e.winnerSeatNo!=e.landlordSeatNo&&e.landlordSeatNo!=G.ownPlayer.seatNo?t.cue.text="你赢了":t.cue.text="你输了",t.cue.visible=!0,window.onlinePlayUI.showPlayerCards(e.seats[G.leftPlayer.seatNo].cardList,e.seats[G.rightPlayer.seatNo].cardList),window.onlinePlayUI.own.getScript("qc.engine.OPlayerUI").scorePanel.text=e.seats[G.ownPlayer.seatNo].score+"",window.onlinePlayUI.refreshInfo(e.seats),window.onlinePlayUI.readyBtn.children[0].text=window.onlinePlayUI.READY,G.ownPlayer.isReady=!1,t._afterGameoverTimer=t.game.timer.add(3e3,function(){window.onlinePlayUI.reset(),window.onlinePlayUI.readyBtn.visible=!0})},OlLandlordUI.prototype.afterGameover=function(){self.cue.visible=!1};var OnlinePlayUI=qc.defineBehaviour("qc.engine.OnlinePlayUI",qc.Behaviour,function(){this.own=null,this.left=null,this.right=null,this.robTimer=null,window.onlinePlayUI=this},{hiddenContainer:qc.Serializer.NODE,msgPrefab:qc.Serializer.PREFAB,deskMsgPrefab:qc.Serializer.PREFAB,cardPrefab:qc.Serializer.PREFAB,clockPrefab:qc.Serializer.PREFAB,readyBtn:qc.Serializer.NODE,exitBtn:qc.Serializer.NODE,myPlayArea:qc.Serializer.NODE,leftPlayArea:qc.Serializer.NODE,rightPlayArea:qc.Serializer.NODE,own:qc.Serializer.NODE,left:qc.Serializer.NODE,right:qc.Serializer.NODE,deskMsgPanel:qc.Serializer.NODE,scorePanel:qc.Serializer.NODE,ratePanel:qc.Serializer.NODE,scoreOne:qc.Serializer.NODE,scoreTwo:qc.Serializer.NODE,scoreThree:qc.Serializer.NODE,scoreZero:qc.Serializer.NODE});OnlinePlayUI.prototype.awake=function(){var e=this;e.init(),e.addListener(e.exitBtn.onClick,function(){confirm("确定离开游戏？")&&(window.onbeforeunload=undefined,G.online.exitGame(),e.robTimer&&e.game.timer.remove(e.robTimer),e.dealTimer&&e.game.timer.remove(e.dealTimer),window.olLandlordUI._playTimer&&window.olLandlordUI.game.timer.remove(window.olLandlordUI._playTimer),e.game.state.load("main",!1,function(){},function(){console.log("main场景加载完毕。")}))},e),e.addListener(e.readyBtn.onClick,function(){G.ownPlayer.isReady?(e.readyBtn.children[0].text=e.READY,G.ownPlayer.isReady=!1):(e.readyBtn.children[0].text=e.CANCEL_READY,G.ownPlayer.isReady=!0),G.online.toggleReady(G.ownPlayer.isReady)},e),e.addListener(e.scoreOne.onClick,function(){e.playerProvideScore(1)},e),e.addListener(e.scoreTwo.onClick,function(){e.playerProvideScore(2)},e),e.addListener(e.scoreThree.onClick,function(){e.playerProvideScore(3)},e),e.addListener(e.scoreZero.onClick,function(){e.playerProvideScore(4)},e)},OnlinePlayUI.prototype.init=function(){var e=this;if(G.netInitData.desk&&G.netInitData.desk.status===G.gameRule.DESK_STATUS_PLAY){var t=G.netInitData.desk.seats[G.netInitData.ownSeatNo],n=G.netInitData.desk.seats;e.readyBtn.visible=!1,this.own.getScript("qc.engine.OPlayerUI").namePanel.text=G.ownPlayer.name,this.own.getScript("qc.engine.OPlayerUI").scorePanel.text=t.score+"",this.refreshInfo(G.netInitData.desk.seats),G.hiddenCards=G.netInitData.desk.hiddenCards,e.showHiddenCards(),G.currentCards=[],G.ownPlayer.cardList=t.cardList;for(var r=0;r<t.cardList.length;r++)e.insertOneCard(t.cardList[r]);var i=function(t,r){e.insertCardForOther(e.left.getScript("qc.engine.OPlayerUI").cardContainer,t.cardList.length),e.insertCardForOther(e.right.getScript("qc.engine.OPlayerUI").cardContainer,r.cardList.length),e.own.getScript("qc.engine.OPlayerUI").showPic(n[G.netInitData.ownSeatNo].isLandlord),e.left.getScript("qc.engine.OPlayerUI").showPic(t.isLandlord),e.right.getScript("qc.engine.OPlayerUI").showPic(r.isLandlord),G.netInitData.ownSeatNo!=G.netInitData.desk.currentPlaySeatNo&&e.game.add.clone(e.clockPrefab,G.netInitData.desk.currentPlaySeatNo==="p2"?e.rightPlayArea:e.leftPlayArea)};t.seatNo==="p1"?i(n.p3,n.p2):t.seatNo==="p2"?i(n.p1,n.p3):i(n.p2,n.p1),e.scorePanel.text=G.netInitData.desk.currentScore+"",e.ratePanel.text=G.netInitData.desk.rate+"",G.netInitData.desk.winCard&&(window.olLandlordUI.winCard=G.netInitData.desk.winCard,window.olLandlordUI.showPlayedCards(G.netInitData.desk.winCard,G.netInitData.desk.roundWinSeatNo===G.leftPlayer.seatNo?e.leftPlayArea:e.rightPlayArea,G.netInitData.desk.roundWinSeatNo===G.leftPlayer.seatNo?e.left.getScript("qc.engine.OPlayerUI").cardContainer:e.right.getScript("qc.engine.OPlayerUI").cardContainer,!0));if(G.netInitData.ownSeatNo===G.netInitData.desk.currentPlaySeatNo){e.game.add.clone(e.clockPrefab,e.myPlayArea);var s=new qc.landlord.AILogic(G.ownPlayer);window.olLandlordUI.promptList=s.prompt(G.netInitData.desk.winCard),window.olLandlordUI.showPlayBtn(G.netInitData.desk.winCard?!1:!0),window.olLandlordUI.addPlayTimer()}}else{var t=G.netInitData.seats[G.netInitData.ownSeatNo];this.own.getScript("qc.engine.OPlayerUI").namePanel.text=G.ownPlayer.name,this.own.getScript("qc.engine.OPlayerUI").scorePanel.text=t.score+"",this.refreshInfo(G.netInitData.seats)}},OnlinePlayUI.prototype.refreshInfo=function(e){var t=this;G.ownPlayer.seatNo=="p1"?(t.setRightInfo(e.p2),t.setLeftInfo(e.p3)):G.ownPlayer.seatNo=="p2"?(t.setRightInfo(e.p3),t.setLeftInfo(e.p1)):G.ownPlayer.seatNo=="p3"&&(t.setRightInfo(e.p1),t.setLeftInfo(e.p2))},OnlinePlayUI.prototype.setLeftInfo=function(e){var t=this;if(e){t.left.getScript("qc.engine.OPlayerUI").scorePanel.text=e.score+"";if(G.leftPlayer&&G.leftPlayer.name==e.name)return;G.leftPlayer=new qc.landlord.Player(e.name),G.leftPlayer.seatNo=e.seatNo,t.left.getScript("qc.engine.OPlayerUI").namePanel.text=G.leftPlayer.name;var n=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);n.text=G.leftPlayer.name+t.ENTER,n.visible=!0,t.playerReady(e)}else{if(G.leftPlayer){t.cleanLeftPlayArea();var n=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);n.text=G.leftPlayer.name+t.LEAVE,n.visible=!0,t.left.getScript("qc.engine.OPlayerUI").scorePanel.text=""}G.leftPlayer=null,t.left.getScript("qc.engine.OPlayerUI").namePanel.text=t.WAITING}},OnlinePlayUI.prototype.setRightInfo=function(e){var t=this;if(e){t.right.getScript("qc.engine.OPlayerUI").scorePanel.text=e.score+"";if(G.rightPlayer&&G.rightPlayer.name==e.name)return;G.rightPlayer=new qc.landlord.Player(e.name),G.rightPlayer.seatNo=e.seatNo,t.right.getScript("qc.engine.OPlayerUI").namePanel.text=G.rightPlayer.name;var n=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);n.text=G.rightPlayer.name+t.ENTER,n.visible=!0,t.playerReady(e)}else{if(G.rightPlayer){t.cleanRightPlayArea();var n=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);n.text=G.rightPlayer.name+t.LEAVE,n.visible=!0,t.right.getScript("qc.engine.OPlayerUI").scorePanel.text=""}G.rightPlayer=null,t.right.getScript("qc.engine.OPlayerUI").namePanel.text=t.WAITING}},OnlinePlayUI.prototype.cleanMyPlayArea=function(){var e=this;if(e.myPlayArea.children.length>0)for(var t=0;t<e.myPlayArea.children.length;t++)e.myPlayArea.children[t].destroy()},OnlinePlayUI.prototype.cleanLeftPlayArea=function(){var e=this;if(e.leftPlayArea.children.length>0)for(var t=0;t<e.leftPlayArea.children.length;t++)e.leftPlayArea.children[t].destroy()},OnlinePlayUI.prototype.cleanRightPlayArea=function(){var e=this;if(e.rightPlayArea.children.length>0)for(var t=0;t<e.rightPlayArea.children.length;t++)e.rightPlayArea.children[t].destroy()},OnlinePlayUI.prototype.playerReady=function(e){var t=this,n=null;G.leftPlayer&&G.leftPlayer.seatNo===e.seatNo?(n=t.leftPlayArea,t.cleanLeftPlayArea()):(n=t.rightPlayArea,t.cleanRightPlayArea());if(e.isReady){var r=t.game.add.clone(t.msgPrefab,n);r.text=t.READY,r.visible=!0}},OnlinePlayUI.prototype.reset=function(){var self=this;self.readyBtn.visible=!1,self.cleanMyPlayArea(),self.cleanLeftPlayArea(),self.cleanRightPlayArea(),self.scorePanel.text="0",self.ratePanel.text="1",window.olLandlordUI.cue.visible=!1,window.olLandlordUI.winCard=null,self.own.getScript("qc.engine.OPlayerUI").headPic.visible=!1,self.left.getScript("qc.engine.OPlayerUI").headPic.visible=!1,self.left.getScript("qc.engine.OPlayerUI").namePanel.color=new qc.Color(4294944e3),G.leftPlayer.isLeave&&(self.left.getScript("qc.engine.OPlayerUI").namePanel.text=self.WAITING,self.left.getScript("qc.engine.OPlayerUI").scorePanel.text="",G.leftPlayer=null),self.right.getScript("qc.engine.OPlayerUI").headPic.visible=!1,self.right.getScript("qc.engine.OPlayerUI").namePanel.color=new qc.Color(4294944e3),G.rightPlayer.isLeave&&(self.right.getScript("qc.engine.OPlayerUI").namePanel.text=self.WAITING,self.right.getScript("qc.engine.OPlayerUI").scorePanel.text="",G.rightPlayer=null);for(var i=0;i<self.hiddenContainer.children.length;i++)self.hiddenContainer.children[i].frame="bg.jpg";with(self.left.getScript("qc.engine.OPlayerUI"))for(var i=cardContainer.children.length-1;i>=0;i--)cardContainer.children[i].destroy();with(self.right.getScript("qc.engine.OPlayerUI"))for(var i=cardContainer.children.length-1;i>=0;i--)cardContainer.children[i].destroy();if(G.currentCards)for(var i=G.currentCards.length-1;i>=0;i--)G.currentCards[i].destroy();G.currentCards=[]},OnlinePlayUI.prototype.start=function(e){var t=this;t.reset();var n=0,r=e.cardList.length;for(var i=0;i<t.deskMsgPanel.children.length;i++)t.deskMsgPanel.children[i].destroy();var s=function(){t.insertCardForOther(t.left.getScript("qc.engine.OPlayerUI").cardContainer),t.insertCardForOther(t.right.getScript("qc.engine.OPlayerUI").cardContainer),t.insertOneCard(e.cardList[n]);if(++n<r)t.dealTimer=t.game.timer.add(200,s);else{G.ownPlayer.cardList=e.cardList,G.ownPlayer.cardList.sort(G.gameRule.cardSort);for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected=!1;t.robLandlord(e.firstRob,0)}};s()},OnlinePlayUI.prototype.insertCardForOther=function(e,t){var n=this;t=t?t:1;for(var r=0;r<t;r++){var i=n.game.add.clone(n.cardPrefab,e);i.visible=!0,i.interactive=!1}},OnlinePlayUI.prototype.insertOneCard=function(e){var t=this,n=0;if(G.currentCards.length!=0&&G.gameRule.cardSort(e,G.currentCards[0].getScript("qc.engine.CardUI").info)===1)for(var r=0;r<G.currentCards.length;r++){var i=G.currentCards[r].getScript("qc.engine.CardUI").info,s=null;r<G.currentCards.length-1&&(s=G.currentCards[r+1].getScript("qc.engine.CardUI").info);if(G.gameRule.cardSort(e,i)===1&&(s&&G.gameRule.cardSort(e,s)===-1||!s)){n=r+1;break}}var o=t.game.add.clone(t.cardPrefab,t.own.getScript("qc.engine.OPlayerUI").cardContainer);o.getScript("qc.engine.CardUI").show(e,!0),o.interactive=!0,t.own.getScript("qc.engine.OPlayerUI").cardContainer.setChildIndex(o,n),G.currentCards.splice(n,0,o)},OnlinePlayUI.prototype.robLandlord=function(e,t,n,r){var i=this;G.ownPlayer.seatNo===e?(i.game.add.clone(i.clockPrefab,i.myPlayArea),i.robTimer=i.game.timer.add(3e4,function(){i.playerProvideScore(4)}),i.showRobBtns(t===4?0:t)):G.leftPlayer.seatNo===e?i.game.add.clone(i.clockPrefab,i.leftPlayArea):i.game.add.clone(i.clockPrefab,i.rightPlayArea),n&&i.showRobScore(n,r),i.scorePanel.text=""+t},OnlinePlayUI.prototype.showRobScore=function(e,t){var n=this,r=null;e===G.ownPlayer.seatNo?r=n.myPlayArea:e===G.leftPlayer.seatNo?r=n.leftPlayArea:r=n.rightPlayArea;for(var i=0;i<r.children.length;i++)r.children[i].destroy();var s=n.game.add.clone(n.msgPrefab,r);s.text=t<4&&t>0?t+"分":"不叫"},OnlinePlayUI.prototype.showRobBtns=function(e){var t=this;t.scoreZero.visible=!0,t.scoreThree.visible=!0,e<2&&(t.scoreTwo.visible=!0),e<1&&(t.scoreOne.visible=!0)},OnlinePlayUI.prototype.hideRobBtns=function(){var e=this;e.scoreZero.visible=!1,e.scoreThree.visible=!1,e.scoreTwo.visible=!1,e.scoreOne.visible=!1},OnlinePlayUI.prototype.playerProvideScore=function(e){var t=this;t.cleanMyPlayArea(),t.robTimer&&t.game.timer.remove(t.robTimer),t.hideRobBtns();var n=t.game.add.clone(t.msgPrefab,t.myPlayArea);n.text=e<4?e+"分":"不叫",G.online.robLandlord(e)},OnlinePlayUI.prototype.showHiddenCards=function(){var e=this;for(var t=0;t<e.hiddenContainer.children.length;t++)e.hiddenContainer.children[t].frame=G.hiddenCards[t].icon},OnlinePlayUI.prototype.setLandlord=function(e){var t=this;e.preSeatNo&&e.preSeatNo!=G.ownPlayer.seatNo&&t.showRobScore(e.preSeatNo,e.preScore),t.scorePanel.text=""+e.currentScore,t.game.timer.add(1e3,function(){t.cleanMyPlayArea(),t.cleanLeftPlayArea(),t.cleanRightPlayArea(),G.hiddenCards=e.hiddenCards,t.showHiddenCards();if(e.landlordSeatNo===G.ownPlayer.seatNo){t.own.getScript("qc.engine.OPlayerUI").showPic(!0),t.left.getScript("qc.engine.OPlayerUI").showPic(!1),t.right.getScript("qc.engine.OPlayerUI").showPic(!1),window.olLandlordUI.showPlayBtn(!0);for(i=0;i<G.hiddenCards.length;i++)t.insertOneCard(G.hiddenCards[i]);G.ownPlayer.cardList=G.ownPlayer.cardList.concat(G.hiddenCards),G.ownPlayer.cardList.sort(G.gameRule.cardSort);for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected=!1;window.olLandlordUI.playTurn({nextSeatNo:G.ownPlayer.seatNo})}else if(e.landlordSeatNo===G.leftPlayer.seatNo){t.own.getScript("qc.engine.OPlayerUI").showPic(!1),t.left.getScript("qc.engine.OPlayerUI").showPic(!0),t.right.getScript("qc.engine.OPlayerUI").showPic(!1),t.game.add.clone(t.clockPrefab,t.leftPlayArea);for(i=0;i<G.hiddenCards.length;i++){var n=t.game.add.clone(t.cardPrefab,t.left.getScript("qc.engine.OPlayerUI").cardContainer);n.visible=!0,n.interactive=!1}}else{t.own.getScript("qc.engine.OPlayerUI").showPic(!1),t.left.getScript("qc.engine.OPlayerUI").showPic(!1),t.right.getScript("qc.engine.OPlayerUI").showPic(!0),t.game.add.clone(t.clockPrefab,t.rightPlayArea);for(i=0;i<G.hiddenCards.length;i++){var n=t.game.add.clone(t.cardPrefab,t.right.getScript("qc.engine.OPlayerUI").cardContainer);n.visible=!0,n.interactive=!1}}})},OnlinePlayUI.prototype.showPlayerCards=function(e,t){var n=this,r=n.left.getScript("qc.engine.OPlayerUI").cardContainer,i=n.right.getScript("qc.engine.OPlayerUI").cardContainer;for(var s=0;s<e.length;s++)r.children[s].frame=e[s].icon;for(s=0;s<t.length;s++)i.children[s].frame=t[s].icon},OnlinePlayUI.prototype.forceExit=function(e){var t=this;if(e.status===2)t.reset(),t.refreshInfo(e.seats),t.hideRobBtns(),t.readyBtn.children[0].text=t.READY,t.readyBtn.visible=!0,G.ownPlayer.isReady=!1,t.robTimer&&t.game.timer.remove(t.robTimer),t.dealTimer&&t.game.timer.remove(t.dealTimer);else if(e.status===3){var n=G.leftPlayer.seatNo===e.exitSeatNo?G.leftPlayer:G.rightPlayer;area=G.leftPlayer.seatNo===e.exitSeatNo?t.left:t.right,area.getScript("qc.engine.OPlayerUI").namePanel.color=new qc.Color(4288256409),n.isLeave=!0;var r=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);r.text=n.name+t.LEAVE,r.visible=!0}},OnlinePlayUI.prototype.playerBack=function(e){var t=this;G.leftPlayer.seatNo===e.seatNo?(G.leftPlayer.isLeave=!1,t.left.getScript("qc.engine.OPlayerUI").namePanel.color=new qc.Color(4294944e3)):G.rightPlayer.seatNo===e.seatNo&&(G.rightPlayer.isLeave=!1,t.right.getScript("qc.engine.OPlayerUI").namePanel.color=new qc.Color(4294944e3));var n=t.game.add.clone(t.deskMsgPrefab,t.deskMsgPanel);n.text=e.name+t.BACK,n.visible=!0},OnlinePlayUI.prototype.WAITING="等待加入",OnlinePlayUI.prototype.LEAVE=" 离开了",OnlinePlayUI.prototype.BACK=" 回来了",OnlinePlayUI.prototype.ENTER=" 加入了游戏",OnlinePlayUI.prototype.READY="准备",OnlinePlayUI.prototype.CANCEL_READY="取消准备";var OPlayerUI=qc.defineBehaviour("qc.engine.OPlayerUI",qc.Behaviour,function(){this.namePanel=null},{namePanel:qc.Serializer.NODE,scorePanel:qc.Serializer.NODE,headPic:qc.Serializer.NODE,cardContainer:qc.Serializer.NODE});OPlayerUI.prototype.showPic=function(e){this.headPic.frame=e?this.PIC_LANDLORD:this.PIC_PEASANT,this.headPic.visible=!0},OPlayerUI.prototype.PIC_LANDLORD="landlord.png",OPlayerUI.prototype.PIC_PEASANT="peasant.png";var RoomMessage=qc.defineBehaviour("qc.engine.RoomMessage",qc.Behaviour,function(){},{});RoomMessage.prototype.awake=function(){var e=this;this.game.timer.add(8e3,function(){e.gameObject.destroy()})};var PlayerUI=qc.defineBehaviour("qc.engine.PlayerUI",qc.Behaviour,function(){this.player=null},{headPic:qc.Serializer.NODE,playerScore:qc.Serializer.NODE,cardContainer:qc.Serializer.NODE}),CardUI=qc.defineBehaviour("qc.engine.CardUI",qc.Behaviour,function(){this.isSelected=!1,this.info=null},{});CardUI.prototype.show=function(e,t){var n=this,r=n.gameObject;e&&(r.frame=e.icon,r.resetNativeSize(),r.visible=!0,n.info=e)},CardUI.prototype.onClick=function(){var e=this;e.isSelected?this.gameObject.anchoredY=0:this.gameObject.anchoredY=-28,e.isSelected=!e.isSelected;var t=window.landlordUI?window.landlordUI:window.olLandlordUI;t.getReadyCardsKind()?t.playBtn.state=qc.UIState.NORMAL:t.playBtn.state=qc.UIState.DISABLED}}).call(this,this,Object)